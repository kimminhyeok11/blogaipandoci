(function(){class u{constructor(t){this.supabase=t||null,this._subscribers=new Set}setClient(t){this.supabase=t}async getSession(){var t;try{if(!((t=this.supabase)!=null&&t.auth))return null;const{data:{session:s}}=await this.supabase.auth.getSession();return s||null}catch(s){return null}}async signOut(){var t;if((t=this.supabase)!=null&&t.auth)try{await this.supabase.auth.signOut()}catch(s){}}async signInWithOtp(t,s){var a;if(!((a=this.supabase)!=null&&a.auth))throw new Error("Auth \uBAA8\uB4C8 \uBBF8\uCD08\uAE30\uD654");const{error:e}=await this.supabase.auth.signInWithOtp({email:t,options:{shouldCreateUser:!0,emailRedirectTo:s}});if(e)throw e;return!0}onAuthStateChange(){var s;return!((s=this.supabase)!=null&&s.auth)||typeof this.supabase.auth.onAuthStateChange!="function"?()=>{}:this.supabase.auth.onAuthStateChange((e,a)=>{this._subscribers.forEach(i=>{try{i(e,a||null)}catch(r){}})})}subscribe(t){return typeof t=="function"&&this._subscribers.add(t),()=>this._subscribers.delete(t)}async logAuthEvent(t,s={}){try{if(!this.supabase)return;const e={type:t,...s,ts:new Date().toISOString()};await this.supabase.from("auth_events").insert(e)}catch(e){}}}window.AuthService=u})();
