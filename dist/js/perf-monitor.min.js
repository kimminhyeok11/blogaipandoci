(function(){if(typeof PerformanceObserver=="undefined")return;const a={};window.PerfMetrics=a;const l="/api/metrics",p=["localhost","127.0.0.1"].includes(window.location.hostname),u=(e,t,o={})=>{try{const n={name:e,value:t,path:window.location.pathname,href:window.location.href,ua:navigator.userAgent,ts:Date.now(),conn:navigator.connection&&navigator.connection.effectiveType||null,...o};if(p)return;const s=JSON.stringify(n);if(navigator.sendBeacon)try{const f=new Blob([s],{type:"application/json"});navigator.sendBeacon(l,f);return}catch(f){}fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:s,keepalive:!0}).catch(()=>{})}catch(n){}},c=new URLSearchParams(window.location.search).get("perf")==="1"||window.Config&&window.Config.SHOW_PERF_OVERLAY===!0;let r=null;const d=()=>{if(c)return r||(r=document.createElement("div"),r.id="perf-overlay",r.setAttribute("role","status"),r.style.cssText=["position:fixed","right:12px","bottom:12px","z-index:9999","background:rgba(17,24,39,0.8)","color:#fff","backdrop-filter:saturate(120%) blur(2px)","border-radius:10px","padding:10px 12px","font:12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR","box-shadow:0 8px 24px rgba(0,0,0,0.25)"].join(";"),r.innerHTML='<div style="font-weight:600;margin-bottom:6px">Performance</div><div id="perf-lines"></div><div style="margin-top:6px;opacity:.8">?perf=1\uB85C \uD45C\uC2DC \uC911</div>',document.body.appendChild(r),r)},m=()=>{if(!c)return;r||d();const e=r.querySelector("#perf-lines"),t=a,o=[["LCP",t.LCP?`${(t.LCP/1e3).toFixed(2)}s`:"-"],["CLS",t.CLS!==void 0?String(t.CLS):"-"],["FID",t.FID!==void 0?`${Math.round(t.FID)}ms`:"-"],["TTFB",t.TTFB!==void 0?`${Math.round(t.TTFB)}ms`:"-"]];e.innerHTML=o.map(([n,s])=>`<div><span style="display:inline-block;width:42px;opacity:.8">${n}</span> <span style="font-weight:600">${s}</span></div>`).join("")},i=(e,t,o={})=>{a[e]=t,["localhost","127.0.0.1"].includes(window.location.hostname)&&console.log(`[perf] ${e}:`,t,o),u(e,t,o),m()};try{const e=()=>{const t=performance&&performance.memory;t&&i("JSHeapUsed",t.usedJSHeapSize,{total:t.totalJSHeapSize,limit:t.jsHeapSizeLimit})};document.readyState==="complete"?e():window.addEventListener("load",()=>setTimeout(e,1200),{once:!0}),window.addEventListener("click",()=>setTimeout(e,800),{once:!0})}catch(e){}try{new PerformanceObserver(t=>{const o=t.getEntries();for(const n of o)i("LongTask",n.duration,{name:n.name||"longtask"})}).observe({type:"longtask",buffered:!0})}catch(e){}try{new PerformanceObserver(t=>{const o=t.getEntries(),n=o[o.length-1];n&&i("LCP",n.renderTime||n.loadTime||n.startTime,{size:n.size})}).observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}try{let e=0;new PerformanceObserver(o=>{for(const n of o.getEntries())n.hadRecentInput||(e+=n.value,i("CLS",Number(e.toFixed(4))))}).observe({type:"layout-shift",buffered:!0})}catch(e){}try{new PerformanceObserver(t=>{const o=t.getEntries();for(const n of o)n.name==="first-input"&&i("FID",n.processingStart-n.startTime)}).observe({type:"first-input",buffered:!0})}catch(e){}try{const e=performance.getEntriesByType("navigation")[0];e&&(i("TTFB",e.responseStart),i("DOM Interactive",e.domInteractive),i("Load Event End",e.loadEventEnd))}catch(e){}c&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d,{once:!0}):d())})();
