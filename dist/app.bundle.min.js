(()=>{var I=Object.defineProperty;var q=(m,t,e)=>t in m?I(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e;var _=(m,t,e)=>q(m,typeof t!="symbol"?t+"":t,e);(function(){let m={SUPABASE_URL:"https://ddehwkwzmmvcxltlplua.supabase.co",SUPABASE_ANON_KEY:"PLACEHOLDER_REPLACE_WITH_REAL_KEY",DB_TABLE_NAME:"posts",IMAGE_BUCKET_NAME:"thought-images",SITE_URL:"https://blogaipandoci.vercel.app",CATEGORIES:["AI","\uAE30\uC220","\uBCF4\uD5D8","\uC77C\uC0C1","\uAE30\uD0C0"],POSTS_PER_PAGE:8,MAX_FILE_SIZE:5242880,ALLOWED_IMAGE_TYPES:["image/jpeg","image/png","image/webp","image/gif"]},t=typeof window!="undefined"&&window.Config?window.Config:{},e=Object.assign({},m,t);typeof window!="undefined"&&(window.Config=e)})();var R={$(m){return document.querySelector(m)},$$(m){return document.querySelectorAll(m)},create(m,t={},e=""){let s=document.createElement(m);return Object.entries(t).forEach(([a,i])=>{a==="className"?s.className=i:a==="innerHTML"?s.innerHTML=i:s.setAttribute(a,i)}),e&&(s.textContent=e),s},show(m,t={}){let e=typeof m=="string"?this.$(m):m;if(!e)return;let a={...{opacity:[0,1],translateY:[10,0],duration:300,easing:"easeOutQuad"},...t};e.style.display="block",window.anime?anime({targets:e,...a}):e.style.opacity="1"},hide(m,t={}){let e=typeof m=="string"?this.$(m):m;if(!e)return;let a={...{opacity:0,duration:200,easing:"easeInQuad",complete:()=>e.style.display="none"},...t};window.anime?anime({targets:e,...a}):(e.style.opacity="0",e.style.display="none")},buildUrl(m,t={}){let e=new URL(m,window.location.origin);return Object.entries(t).forEach(([s,a])=>{a!=null&&a!==""&&e.searchParams.set(s,a)}),e.pathname+e.search},openModal(m){let t=this.$(`#${m}`);if(!t)return;t.classList.remove("hidden"),this.show(t),document.body.classList.add("modal-open");try{["#app-container","#main-nav-container"].forEach(d=>{let l=document.querySelector(d);l&&!t.contains(l)&&(l.setAttribute("inert",""),l.setAttribute("aria-hidden","true"))})}catch(c){}let e=t.querySelector(".modal-content");if(e){e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true");let c=e.querySelector(".modal-title");c&&(c.id||(c.id=`${m}-title`),e.setAttribute("aria-labelledby",c.id));let d=e.querySelector(".modal-message, .modal-body");if(d&&!e.hasAttribute("aria-describedby")){let l=`${m}-desc`;d.id||(d.id=l),e.setAttribute("aria-describedby",d.id)}}t.__returnFocus=document.activeElement;let a=Array.from(t.querySelectorAll('a[href], area[href], button:not([disabled]), input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(c=>c.offsetParent!==null)[0]||e;a&&(a.hasAttribute("tabindex")||a.setAttribute("tabindex","-1"),a.focus({preventScroll:!0}));let i=c=>{if(c.key==="Tab"){let d=Array.from(t.querySelectorAll('a[href], area[href], button:not([disabled]), input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(h=>h.offsetParent!==null);if(d.length===0)return;let l=d[0],r=d[d.length-1],p=document.activeElement;c.shiftKey?(p===l||!t.contains(p))&&(c.preventDefault(),r.focus()):p===r&&(c.preventDefault(),l.focus())}else c.key==="Escape"&&this.closeModal(m)};t.__onKeydown=i,t.addEventListener("keydown",i,!0);let n=t.querySelector(".modal-overlay"),o=c=>{c.target===n&&this.closeModal(m)};n&&(t.__onOverlayClick=o,n.addEventListener("click",o))},closeModal(m){let t=this.$(`#${m}`);if(!t)return;t.__onKeydown&&(t.removeEventListener("keydown",t.__onKeydown,!0),t.__onKeydown=null);let e=t.querySelector(".modal-overlay");e&&t.__onOverlayClick&&(e.removeEventListener("click",t.__onOverlayClick),t.__onOverlayClick=null),this.hide(t,{complete:()=>{t.classList.add("hidden"),document.body.classList.remove("modal-open");try{["#app-container","#main-nav-container"].forEach(i=>{let n=document.querySelector(i);n&&(n.removeAttribute("inert"),n.removeAttribute("aria-hidden"))})}catch(a){}let s=t.__returnFocus;s&&typeof s.focus=="function"&&s.focus({preventScroll:!0}),t.__returnFocus=null;try{t.removeAttribute("aria-modal")}catch(a){}}})},showLoading(m="body"){let t=typeof m=="string"?this.$(m):m;if(!t)return;let e=this.create("div",{className:"loading-spinner",style:"position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.6);backdrop-filter:saturate(120%) blur(2px);",innerHTML:`
                <div class="flex items-center justify-center p-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
                    <span class="ml-3 text-gray-700">\uB85C\uB529 \uC911...</span>
                </div>
            `});return t.appendChild(e),e},hideLoading(m="body"){let t=typeof m=="string"?this.$(m):m,e=t==null?void 0:t.querySelector(".loading-spinner");e&&e.remove()}};window.DOM=R;var U={_toastQueue:[],_maxToastStack:3,showToast(m,t="info",e=3e3){var d;let s=DOM.$("#toast-container")||this.createToastContainer(),a=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,i=Array.from(s.children||[]).find(l=>{var r;try{return((r=l.querySelector(".text-sm.font-medium"))==null?void 0:r.textContent)===m}catch(p){return!1}});if(i){let l=i.querySelector(".flex.items-center");l&&(l.className=`flex items-center p-4 mb-4 text-sm rounded-lg shadow-lg ${this.getToastClasses(t)}`);let r=i.querySelector(".flex-shrink-0");r&&(r.innerHTML=this.getToastIcon(t));let p=i.dataset.timerId?Number(i.dataset.timerId):null;if(p)try{clearTimeout(p)}catch(u){}let h=setTimeout(()=>{i.classList.add("translate-x-full"),setTimeout(()=>{i.remove(),this._drainToastQueue()},300)},e);i.dataset.timerId=String(h),s.appendChild(i);try{let u=document.activeElement;u&&(u.tagName==="BUTTON"||u.tagName==="A"||u.getAttribute("role")==="button")&&i.focus({preventScroll:!0})}catch(u){}return}if((((d=s.children)==null?void 0:d.length)||0)>=this._maxToastStack){this._toastQueue.push({message:m,type:t,duration:e});return}let n=DOM.create("div",{className:`toast toast-${t} ${a?"":"transform translate-x-full transition-transform duration-300 ease-in-out"}`,role:t==="error"||t==="warning"?"alert":"status","aria-live":t==="error"||t==="warning"?"assertive":"polite",tabIndex:"-1",innerHTML:`
                <div class="flex items-center p-4 mb-4 text-sm rounded-lg shadow-lg ${this.getToastClasses(t)}">
                    <div class="flex-shrink-0">
                        ${this.getToastIcon(t)}
                    </div>
                    <div class="ml-3 text-sm font-medium">${m}</div>
                    <button type="button" class="toast-close ml-auto -mx-1.5 -my-1.5 rounded-lg p-1.5 hover:bg-gray-100 inline-flex h-8 w-8" aria-label="\uB2EB\uAE30">
                        <span class="sr-only">\uB2EB\uAE30</span>
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
            `});s.appendChild(n),a?n.classList.remove("translate-x-full"):setTimeout(()=>{n.classList.remove("translate-x-full")},100);try{let l=document.activeElement;l&&(l.tagName==="BUTTON"||l.tagName==="A"||l.getAttribute("role")==="button")&&n.focus({preventScroll:!0})}catch(l){}let o=n.querySelector(".toast-close");o&&o.addEventListener("click",()=>{n.remove(),this._drainToastQueue()});let c=setTimeout(()=>{n.classList.add("translate-x-full"),setTimeout(()=>{n.remove(),this._drainToastQueue()},300)},e);n.dataset.timerId=String(c)},_drainToastQueue(){var t;let m=DOM.$("#toast-container")||this.createToastContainer();for(;this._toastQueue.length&&(((t=m.children)==null?void 0:t.length)||0)<this._maxToastStack;){let e=this._toastQueue.shift();if(!e)break;this.showToast(e.message,e.type,e.duration)}},createToastContainer(){let m=DOM.create("div",{id:"toast-container",className:"fixed top-4 right-4 z-50 space-y-2","aria-live":"polite","aria-atomic":"true"});return document.body.appendChild(m),m},getToastClasses(m){let t={success:"text-green-800 bg-green-50 border border-green-200",error:"text-red-800 bg-red-50 border border-red-200",warning:"text-yellow-800 bg-yellow-50 border border-yellow-200",info:"text-blue-800 bg-blue-50 border border-blue-200"};return t[m]||t.info},getToastIcon(m){let t={success:'<svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>',error:'<svg class="w-5 h-5 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>',warning:'<svg class="w-5 h-5 text-yellow-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>',info:'<svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>'};return t[m]||t.info},showConfirm(m,t,e){let s=document.getElementById("modal-container")||document.body,a=`confirm-modal-${Date.now()}`,i=DOM.create("div",{id:a,className:"hidden",innerHTML:`
                <div class="modal-overlay">
                    <div class="modal-content confirm-modal modal-danger modal-content-md">
                        <div class="modal-header">
                            <h3 class="modal-title">\uD655\uC778</h3>
                            <button class="modal-close" aria-label="\uB2EB\uAE30">\u2715</button>
                        </div>
                        <div class="modal-body">
                            <div class="modal-icon">\u26A0\uFE0F</div>
                            <p class="modal-message">${m}</p>
                        </div>
                        <div class="modal-footer">
                            <button class="btn px-4 py-2 rounded-lg border cancel-btn">\uCDE8\uC18C</button>
                            <button class="btn px-4 py-2 rounded-lg bg-red-600 text-white confirm-btn">\uD655\uC778</button>
                        </div>
                    </div>
                </div>`});s.appendChild(i);let n=i.querySelector(".cancel-btn"),o=i.querySelector(".confirm-btn"),c=i.querySelector(".modal-close"),d=()=>{setTimeout(()=>i.remove(),200)},l=()=>{DOM.closeModal(a),d(),e&&e()},r=()=>{DOM.closeModal(a),d(),t&&t()};n&&n.addEventListener("click",l),o&&o.addEventListener("click",r),c&&c.addEventListener("click",l),DOM.openModal(a)},createProgressBar(m,t=0){var a;let e=DOM.create("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-4",innerHTML:`
                <div class="progress-bar-fill bg-purple-600 h-2.5 rounded-full transition-all duration-300 ease-out" style="width: ${t}%"></div>
            `}),s=e.querySelector(".progress-bar-fill");return typeof m=="string"?(a=DOM.$(m))==null||a.appendChild(e):m==null||m.appendChild(e),{update(i){s.style.width=`${Math.min(100,Math.max(0,i))}%`},remove(){e.remove()}}},createSkeleton(m="post"){let t={post:`
                <div class="animate-pulse">
                    <div class="flex space-x-4 p-4">
                        <div class="rounded-lg bg-gray-300 h-16 w-24"></div>
                        <div class="flex-1 space-y-2 py-1">
                            <div class="h-4 bg-gray-300 rounded w-3/4"></div>
                            <div class="h-3 bg-gray-300 rounded w-1/2"></div>
                            <div class="h-3 bg-gray-300 rounded w-1/4"></div>
                        </div>
                    </div>
                </div>
            `,card:`
                <div class="animate-pulse">
                    <div class="bg-gray-300 h-48 rounded-lg mb-4"></div>
                    <div class="h-4 bg-gray-300 rounded w-3/4 mb-2"></div>
                    <div class="h-3 bg-gray-300 rounded w-1/2"></div>
                </div>
            `};return DOM.create("div",{className:"skeleton-loader",innerHTML:t[m]||t.post})}};window.UIComponents=U;try{typeof window!="undefined"&&(window.Config=window.Config||(typeof Config!="undefined"?Config:{}));let m=window.Config}catch(m){}var H=class{constructor(){_(this,"state",{user:null,isAuthReady:!1,currentCategory:"\uC804\uCCB4",editorInstance:null,archives:{category:"\uC804\uCCB4",tag:"",page:1,pageSize:20,sort:"latest",total:0}});_(this,"supabase",null);_(this,"authService",null);_(this,"_inFlight",new Map);_(this,"_reqTokens",{home:0,archives:0,popular:0});_(this,"_scrollStore",new Map);_(this,"_isPopNavigating",!1);this.handleGlobalClick=this.handleGlobalClick.bind(this),this.handlePopState=this.handlePopState.bind(this),this.init()}async withDedupe(t,e){if(this._inFlight.has(t))return this._inFlight.get(t);let s=(async()=>{try{return await e()}finally{this._inFlight.delete(t)}})();return this._inFlight.set(t,s),s}async init(){var t,e,s;try{if(await this.ensureSupabaseReady(1200),window.AuthService&&this.supabase){this.authService=new window.AuthService(this.supabase),this.authService.subscribe((i,n)=>{this.state.user=(n==null?void 0:n.user)||null;try{this._logAuthEvent("auth_state_change",{event:i})}catch(o){}this.renderNav()});try{this.authService.onAuthStateChange()}catch(i){}}if(this.bindGlobalListeners(),this.authService){let i=await this.authService.getSession();this.state.user=(i==null?void 0:i.user)||null;try{let n=new URL(window.location.href),o=n.searchParams,c=window.location.hash||"",d=o.get("token_hash"),l=(o.get("type")||"").toLowerCase(),r=this._normalizeOtpType(l),p=o.get("code"),h=/access_token=|refresh_token=|type=recovery/.test(c);if(d&&r){this.setLoading(!0);try{let{data:u,error:g}=await this.supabase.auth.verifyOtp({token_hash:d,type:r});if(!g&&((t=u==null?void 0:u.session)!=null&&t.user)){this.state.user=u.session.user,o.delete("token_hash"),o.delete("type");let v=n.pathname+(o.toString()?"?"+o.toString():"");window.history.replaceState({},document.title,v),UIComponents.showToast(this.state.user.email+"\uB2D8, \uB85C\uADF8\uC778\uB418\uC5C8\uC2B5\uB2C8\uB2E4.","success"),this.renderNav(),this.navigate("/")}else g&&(console.warn("verifyOtp \uC624\uB958:",g),UIComponents.showToast("\uB85C\uADF8\uC778 \uD1A0\uD070 \uD655\uC778\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4. \uB9C1\uD06C\uB97C \uB2E4\uC2DC \uC694\uCCAD\uD574\uC8FC\uC138\uC694.","error"))}catch(u){console.warn("verifyOtp \uC2E4\uD328:",u)}}else if(d&&!r){this.setLoading(!0);try{let{data:u,error:g}=await this.supabase.auth.verifyOtp({token_hash:d,type:"magiclink"});if(!g&&((e=u==null?void 0:u.session)!=null&&e.user)){this.state.user=u.session.user,o.delete("token_hash");let v=n.pathname+(o.toString()?"?"+o.toString():"");window.history.replaceState({},document.title,v),UIComponents.showToast(this.state.user.email+"\uB2D8, \uB85C\uADF8\uC778\uB418\uC5C8\uC2B5\uB2C8\uB2E4.","success"),this.renderNav(),this.navigate("/")}else g&&(console.warn("verifyOtp(magiclink, fallback) \uC624\uB958:",g),UIComponents.showToast("\uB85C\uADF8\uC778 \uB9C1\uD06C \uD655\uC778 \uC2E4\uD328. \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.","error"))}catch(u){console.warn("verifyOtp(magiclink, fallback) \uC2E4\uD328:",u)}}else if(p){this.setLoading(!0);try{let{data:u,error:g}=await this.supabase.auth.exchangeCodeForSession({code:p});if(!g&&((s=u==null?void 0:u.session)!=null&&s.user)){this.state.user=u.session.user,o.delete("code");let v=n.pathname+(o.toString()?"?"+o.toString():"");window.history.replaceState({},document.title,v),UIComponents.showToast(this.state.user.email+"\uB2D8, \uB85C\uADF8\uC778\uB418\uC5C8\uC2B5\uB2C8\uB2E4.","success"),this.renderNav(),this.navigate("/")}}catch(u){console.warn("exchangeCodeForSession \uC2E4\uD328:",u)}}else if(h){this.setLoading(!0);let{data:{session:u}}=await this.supabase.auth.getSession();if(u!=null&&u.user){this.state.user=u.user;let g=n.pathname+(o.toString()?"?"+o.toString():"");window.history.replaceState({},document.title,g),UIComponents.showToast(u.user.email+"\uB2D8, \uB85C\uADF8\uC778\uB418\uC5C8\uC2B5\uB2C8\uB2E4.","success"),this.renderNav(),this.navigate("/")}}}catch(n){}}else this.state.user=null;this.state.isAuthReady=!0,this.renderNav(),this.handleRouting(),window.addEventListener("popstate",this.handlePopState);let a=DOM.$("#app-loader");a&&DOM.hide(a,{complete:()=>a.remove()}),this.supabase&&this.supabase.auth&&typeof this.supabase.auth.onAuthStateChange=="function"&&this.supabase.auth.onAuthStateChange((i,n)=>{var d;let o=(n==null?void 0:n.user)||null,c=((d=this.state.user)==null?void 0:d.id)!==(o==null?void 0:o.id);this.state.user=o,c&&(this.renderNav(),o?UIComponents.showToast(o.email+"\uB2D8, \uD658\uC601\uD569\uB2C8\uB2E4!","success"):(UIComponents.showToast("\uB85C\uADF8\uC544\uC6C3\uB418\uC5C8\uC2B5\uB2C8\uB2E4.","info"),this.navigate("/")))});try{this.supabase&&await this.logSiteVisit()}catch(i){console.warn("\uBC29\uBB38 \uB85C\uADF8 \uAE30\uB85D \uC2E4\uD328:",i)}}catch(a){console.error("App initialization failed:",a),UIComponents.showToast("\uC571 \uCD08\uAE30\uD654 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.","error");let i=DOM.$("#app-loader");i&&(i.innerHTML='<div class="text-red-600">\uC571 \uB85C\uB4DC\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.</div>')}}_normalizeOtpType(t=""){switch(String(t||"").toLowerCase()){case"login":case"signin":case"email":return"magiclink";case"register":return"signup";case"recover":return"recovery";case"magiclink":case"signup":case"recovery":case"invite":return t;default:return t||"magiclink"}}async ensureSupabaseReady(t=800){var e,s,a,i;try{if(this.supabase)return!0;let n=Date.now();if(window.supabase&&((e=window.Config)!=null&&e.SUPABASE_URL)&&((s=window.Config)!=null&&s.SUPABASE_ANON_KEY))return this.supabase=window.supabase.createClient(window.Config.SUPABASE_URL,window.Config.SUPABASE_ANON_KEY,{auth:{storageKey:"sb-insurelog-auth-token"}}),!0;for(;Date.now()-n<t;)if(await new Promise(o=>setTimeout(o,50)),window.supabase&&((a=window.Config)!=null&&a.SUPABASE_URL)&&((i=window.Config)!=null&&i.SUPABASE_ANON_KEY))return this.supabase=window.supabase.createClient(window.Config.SUPABASE_URL,window.Config.SUPABASE_ANON_KEY,{auth:{storageKey:"sb-insurelog-auth-token"}}),!0;return!!this.supabase}catch(n){return console.warn("ensureSupabaseReady \uC2E4\uD328:",n),!1}}bindGlobalListeners(){document.addEventListener("click",this.handleGlobalClick),document.addEventListener("keydown",t=>{if(t.key==="Escape"){let e=document.querySelector('[id*="modal"]:not(.hidden)');e&&e.id&&DOM.closeModal(e.id)}try{this._keySeq=this._keySeq||[];let e=(t.key||"").toLowerCase();if(e==="g"){this._keySeq=["g"];return}this._keySeq[0]==="g"&&(e==="a"?(t.preventDefault(),this.navigate("/archives")):e==="d"?(t.preventDefault(),this.navigate("/dashboard")):e==="l"&&(t.preventDefault(),this.navigate("/login")),this._keySeq=[])}catch(e){}})}handleGlobalClick(t){let e=t.target.closest("[data-route]");if(e){let s=!!(t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||t.button!==void 0&&t.button!==0),a=e.tagName==="A"?e:e.closest("a"),i=a&&(a.getAttribute("target")==="_blank"||a.hasAttribute("download"));if(s||i)return;t.preventDefault();let n=e.getAttribute("href")||e.getAttribute("data-href");n&&n!=="#"&&this.navigate(n)}if(t.target.classList&&t.target.classList.contains("modal-overlay")){let s=t.target.closest('[id*="modal"]');s&&s.id&&DOM.closeModal(s.id)}}handlePopState(){this._isPopNavigating=!0,this.handleRouting(),this.renderNav();try{this.restoreScrollForCurrentPath()}catch(t){}this._isPopNavigating=!1}navigate(t){let e=this.normalizePath(t);if(window.location.pathname+window.location.search!==e){try{this.saveScrollForCurrentPath()}catch(i){}window.history.pushState(null,"",e),this.handleRouting(),this.renderNav()}}handleRouting(){let t=this.normalizePath(window.location.pathname),e=new URLSearchParams(window.location.search),s;t==="/"||t==="/home"||t==="/library"?s="view-library":t==="/archives"||t==="/archive"||t==="/post"?s="view-archives":t.startsWith("/post/")?s="view-post":t==="/dashboard"?s="view-dashboard":t==="/writer"||t.startsWith("/writer/")?s="view-writer":s="view-library";let a=DOM.$(".app-view.active");a&&a.id!==s&&(a.classList.remove("active"),DOM.hide(a));try{let i=window.Router&&typeof window.Router.resolve=="function"?window.Router.resolve(t):null;if(i&&typeof i.exec=="function"){if(i.requiresAuth&&!this.checkAuth(!0))return;i.exec(this,e)}else this.render404()}catch(i){console.warn("Router \uCC98\uB9AC \uC911 \uC624\uB958:",i),this.render404()}}bindModalCloseHandlers(t,e={}){try{let s=DOM.$(`#${t}`);if(!s)return;let{closeSelector:a=".modal-close",cancelSelector:i=".cancel-btn",onClose:n=null}=e,o=()=>{if(DOM.closeModal(t),typeof n=="function")try{n()}catch(l){}},c=s.querySelector(a),d=s.querySelector(i);c&&c.addEventListener("click",o),d&&d.addEventListener("click",o)}catch(s){}}renderDashboard(t="#view-dashboard"){var a;if(!this.checkAuth(!0))return;this.switchToView("view-dashboard");let e=DOM.$(t);if(!e)return;let s=((a=this.state.user)==null?void 0:a.email)||"\uC54C \uC218 \uC5C6\uC74C";e.innerHTML=`
          <section class="max-w-4xl mx-auto py-10 px-6">
            <div class="flex items-center justify-between mb-4">
              <h1 class="text-2xl font-bold">\uB300\uC2DC\uBCF4\uB4DC</h1>
              <a href="/writer" data-route class="px-3 py-2 rounded-lg bg-black text-white">\uC0C8 \uAE00 \uC4F0\uAE30</a>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div class="p-4 border rounded-lg">
                <h2 class="text-lg font-semibold mb-2">\uACC4\uC815</h2>
                <p class="text-sm text-gray-600">\uC774\uBA54\uC77C: ${this.escapeHTML(s)}</p>
              </div>
              <div class="p-4 border rounded-lg">
                <h2 class="text-lg font-semibold mb-2">\uCD5C\uADFC \uD65C\uB3D9</h2>
                <div id="dashboard-recent" class="text-sm text-gray-600">\uBD88\uB7EC\uC624\uB294 \uC911\u2026</div>
              </div>
            </div>
          </section>`,this.updatePageMeta("\uB300\uC2DC\uBCF4\uB4DC - InsureLog","\uB0B4 \uACC4\uC815 \uBC0F \uCD5C\uADFC \uD65C\uB3D9",window.location.href,"/og-image.svg"),this.loadRecentActivities().catch(i=>this.handleError(i,"loadRecentActivities"))}async loadRecentActivities(){try{if(!this.supabase)return;let t=window.Config&&window.Config.DB_TABLE_NAME||"posts",{data:e,error:s}=await this.supabase.from(t).select("id, title, slug, status, updated_at").order("updated_at",{ascending:!1}).limit(5);if(s)throw s;let a=DOM.$("#dashboard-recent");if(!a)return;if(!e||e.length===0){a.textContent="\uCD5C\uADFC \uD3B8\uC9D1 \uD56D\uBAA9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.";return}a.innerHTML='<ul class="space-y-2">'+e.map(i=>{let n="/writer/"+i.slug,o=this.formatDateKR(i.updated_at);return`<li class="flex items-center justify-between">
                    <a href="${n}" data-route class="text-sm font-medium">${this.escapeHTML(i.title||"\uC81C\uBAA9 \uC5C6\uC74C")}</a>
                    <span class="text-xs text-gray-500">${o}</span>
                </li>`}).join("")+"</ul>"}catch(t){this.handleError(t,"loadRecentActivities")}}normalizePath(t){try{let e=new URL(t,window.location.origin),s=e.pathname||"/";try{s=decodeURI(s)}catch(a){}return s==="/index.html"&&(s="/"),s.length>1&&s.endsWith("/")&&(s=s.slice(0,-1)),s=s.replace(/\/+/g,"/"),s+(e.search||"")}catch(e){return t==="/index.html"?"/":t.length>1&&t.endsWith("/")?t.slice(0,-1):t||"/"}}getQueryParams(){let t=new URLSearchParams(window.location.search),e={};return t.forEach((s,a)=>{e[a]=s}),e}updateRobotsMeta(t="index,follow"){let e=DOM.$('meta[name="robots"]');e&&(e.content=t)}updatePrevNextLinks(t=1,e=1){let s=document.head;if(!s)return;let a=d=>{let l=s.querySelector(`link[rel="${d}"]`);return l||(l=document.createElement("link"),l.setAttribute("rel",d),s.appendChild(l)),l},i=new URL(window.location.href),n=d=>{let l=new URL(i.href);return l.searchParams.set("page",String(d)),l.toString()},o=a("prev");e>1?o.setAttribute("href",n(e-1)):o.removeAttribute("href");let c=a("next");e<t?c.setAttribute("href",n(e+1)):c.removeAttribute("href")}focusFirstInView(t){try{let e=DOM.$("#"+t);if(!e)return;e.hasAttribute("tabindex")||e.setAttribute("tabindex","-1"),e.focus({preventScroll:!0})}catch(e){}}saveScrollForCurrentPath(){let t=window.location.pathname+window.location.search;this._scrollStore.set(t,{x:window.scrollX,y:window.scrollY})}restoreScrollForCurrentPath(){let t=window.location.pathname+window.location.search,e=this._scrollStore.get(t);e&&typeof e.y=="number"&&window.scrollTo({left:e.x||0,top:e.y||0,behavior:"auto"})}renderArchives(t="#view-archives"){t==="#view-archives"&&this.switchToView("view-archives");let e=DOM.$(t);if(!e)return;try{let h=new URLSearchParams(window.location.search),u=h.get("category"),g=h.get("tag"),v=Number(h.get("page")||this.state.archives.page)||1,x=Number(h.get("pageSize")||this.state.archives.pageSize)||20,M=h.get("sort")||this.state.archives.sort||"latest";this.state.archives.category=u||this.state.archives.category||"\uC804\uCCB4",this.state.archives.tag=g||this.state.archives.tag||"",this.state.archives.page=v,this.state.archives.pageSize=x,this.state.archives.sort=["latest","oldest","title"].includes(M)?M:"latest"}catch(h){}let{category:s,tag:a,pageSize:i,sort:n}=this.state.archives;e.innerHTML=`<section class="max-w-4xl mx-auto py-10 px-6"><div class="flex items-center justify-between"><h1 class="text-2xl font-bold">\uC544\uCE74\uC774\uBE0C</h1><div id="archives-header-info" class="text-xs text-gray-500">\uD398\uC774\uC9C0\uB2F9 ${i}\uAC1C</div></div><div class="mt-4 grid grid-cols-1 sm:grid-cols-4 gap-3"><div><label class="block text-xs text-gray-600">\uCE74\uD14C\uACE0\uB9AC</label><select id="archives-filter-category" class="mt-1 w-full border rounded-lg p-2"><option value="\uC804\uCCB4">\uC804\uCCB4</option></select></div><div><label class="block text-xs text-gray-600">\uD0DC\uADF8</label><input id="archives-filter-tag" type="text" class="mt-1 w-full border rounded-lg p-2" placeholder="\uC608: \uBCF4\uD5D8"></div><div><label class="block text-xs text-gray-600">\uC815\uB82C</label><select id="archives-filter-sort" class="mt-1 w-full border rounded-lg p-2"><option value="latest">\uCD5C\uC2E0\uC21C</option><option value="oldest">\uC624\uB798\uB41C\uC21C</option><option value="title">\uC81C\uBAA9\uC21C</option></select></div><div><label class="block text-xs text-gray-600">\uAC1C\uC218</label><select id="archives-filter-pageSize" class="mt-1 w-full border rounded-lg p-2"><option value="10">10</option><option value="20">20</option><option value="50">50</option></select></div><div class="sm:col-span-4 flex items-center justify-end"><button id="archives-filter-apply" class="px-3 py-2 rounded-lg bg-black text-white">\uD544\uD130 \uC801\uC6A9</button></div></div><div id="archives-list" class="mt-6 space-y-6"></div><div id="archives-pagination" class="mt-8 flex items-center justify-center gap-2"></div></section>`;let o=this.state.archives.page||1,c=o>1?`\uC544\uCE74\uC774\uBE0C - \uD398\uC774\uC9C0 ${o} - InsureLog`:"\uC544\uCE74\uC774\uBE0C - InsureLog";this.updatePageMeta(c,"\uC6D4\uBCC4 \uC544\uCE74\uC774\uBE0C\uC640 \uCE74\uD14C\uACE0\uB9AC/\uD0DC\uADF8 \uD544\uD130",window.location.href,"/og-image.svg");let d=DOM.$("#archives-filter-tag");d&&(d.value=a||"");let l=DOM.$("#archives-filter-sort");l&&(l.value=n||"latest");let r=DOM.$("#archives-filter-pageSize");r&&(r.value=String(i||20));let p=DOM.$("#archives-filter-apply");p&&(p.onclick=()=>{let h=DOM.$("#archives-filter-category"),u=DOM.$("#archives-filter-tag"),g=DOM.$("#archives-filter-sort"),v=DOM.$("#archives-filter-pageSize");this.state.archives.category=h?h.value:"\uC804\uCCB4",this.state.archives.tag=u?u.value.trim():"",this.state.archives.sort=g?g.value:"latest",this.state.archives.pageSize=v&&Number(v.value)||20,this.state.archives.page=1;let x=new URLSearchParams({category:this.state.archives.category||"\uC804\uCCB4",tag:this.state.archives.tag||"",sort:this.state.archives.sort||"latest",pageSize:String(this.state.archives.pageSize||20),page:"1"});this.navigate(`/archives?${x.toString()}`)}),this.loadArchives().catch(h=>this.handleError(h,"loadArchives"))}async loadArchives(){let{category:t,tag:e,page:s,pageSize:a,sort:i}=this.state.archives,n=DOM.$("#archives-list");if(!n||!this.supabase)return;let o=window.Config&&window.Config.DB_TABLE_NAME||"posts",c=this.supabase.from(o).select("id",{count:"exact",head:!0}).eq("status","published");t&&t!=="\uC804\uCCB4"&&(c=c.eq("category",t)),e&&(c=c.contains("tags",[String(e).toLowerCase()]));let{count:d}=await c;this.state.archives.total=d||0;let r=this.supabase.from(o).select("id, title, slug, created_at, category, thumbnail_url").eq("status","published");e&&(r=r.contains("tags",[String(e).toLowerCase()])),i==="latest"?r=r.order("created_at",{ascending:!1}):i==="oldest"?r=r.order("created_at",{ascending:!0}):i==="title"?r=r.order("title",{ascending:!0}):r=r.order("created_at",{ascending:!1}),t&&t!=="\uC804\uCCB4"&&(r=r.eq("category",t));let p=(s-1)*a,h=p+a-1;r=r.range(p,h);let u=Date.now();this._reqTokens.archives=u;let g=`archives:${t}:${e}:${p}-${h}`,{data:v,error:x}=await this.withDedupe(g,()=>r);if(x)throw x;let M=new Set(["\uC804\uCCB4"]);(v||[]).forEach(b=>{b.category&&M.add(b.category)});let f=DOM.$("#archives-filter-category");f&&f.options.length<=1&&(f.innerHTML=Array.from(M).map(b=>`<option value="${this.escapeHTML(b)}">${this.escapeHTML(b)}</option>`).join(""),f.value=t||"\uC804\uCCB4");let w=v||[];if(this._reqTokens.archives===u){if(!w||w.length===0)n.innerHTML='<div class="text-gray-500">\uD45C\uC2DC\uD560 \uAC8C\uC2DC\uAE00\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.</div>';else{let b=this.renderPostsListHTML(w);n.innerHTML=`<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">${b}</div>`}this.renderArchivesPagination();try{let b=Math.max(1,Math.ceil((this.state.archives.total||0)/(this.state.archives.pageSize||20)));this.updatePrevNextLinks(b,this.state.archives.page||1);let y=(this.state.archives.page||1)>1||!!this.state.archives.tag;this.updateRobotsMeta(y?"noindex,follow":"index,follow")}catch(b){}try{let b=(s-1)*a+1,y=Math.min(this.state.archives.total,s*a),L=document.querySelector("#view-archives section .text-xs.text-gray-500");L&&(L.textContent=`\uCD1D ${this.state.archives.total}\uAC1C \xB7 ${b}\u2013${y} \uD45C\uC2DC\uC911`)}catch(b){}}}renderArchivesPagination(){let{page:t,pageSize:e,total:s}=this.state.archives,a=Math.max(1,Math.ceil(s/e)),i=DOM.$("#archives-pagination");if(!i)return;if(a<=1){i.innerHTML="";return}let n=(h,u=null,g=!1)=>`<button data-page="${h}" ${g?'aria-current="page"':""} aria-label="${u||`\uD398\uC774\uC9C0 ${h}`}" class="px-3 py-1 rounded border ${g?"bg-black text-white":"hover:bg-black/5"}">${u||h}</button>`,o=t>1?n(t-1,"\uC774\uC804"):'<span class="px-3 py-1 text-gray-400" aria-hidden="true">\uC774\uC804</span>',c=t<a?n(t+1,"\uB2E4\uC74C"):'<span class="px-3 py-1 text-gray-400" aria-hidden="true">\uB2E4\uC74C</span>',d=5,l=Math.max(1,t-Math.floor(d/2)),r=Math.min(a,l+d-1),p=[];for(let h=l;h<=r;h++)p.push(n(h,null,h===t));i.innerHTML=o+p.join("")+c,i.querySelectorAll("button[data-page]").forEach(h=>{h.onclick=()=>{let u=Number(h.getAttribute("data-page"))||1;this.state.archives.page=u;let g=new URLSearchParams({category:this.state.archives.category||"\uC804\uCCB4",tag:this.state.archives.tag||"",sort:this.state.archives.sort||"latest",pageSize:String(this.state.archives.pageSize||20),page:String(u)});this.navigate(`/archives?${g.toString()}`)}})}switchToView(t){let e=DOM.$("#"+t);DOM.$$(".app-view").forEach(s=>{s!==e&&(s.classList.remove("active"),DOM.hide(s))}),e&&(e.style.display="block",e.classList.add("active"),DOM.show(e),this._isPopNavigating||window.scrollTo({top:0,behavior:"smooth"}),this.focusFirstInView(t),window.LayoutManager&&typeof window.LayoutManager.onViewRendered=="function"&&window.LayoutManager.onViewRendered(e))}renderNav(){let t=DOM.$("#main-nav-container");if(!t)return;let e=!!this.state.user,s=t.querySelector("#nav-links");if(s&&this._navLogged===e){let r=this.normalizePath(window.location.pathname);r==="/archive"&&(r="/archives"),r==="/post"&&(r="/archives"),(r==="/home"||r==="/library")&&(r="/"),s.querySelectorAll("a[data-route]").forEach(p=>{let h=p.getAttribute("href"),u="/";try{u=this.normalizePath(new URL(h,window.location.origin).pathname)}catch(v){u=this.normalizePath(h||"/")}u==="/archive"&&(u="/archives"),(u==="/home"||u==="/library")&&(u="/"),u===r?p.setAttribute("aria-current","page"):p.removeAttribute("aria-current")});return}let o=['<a href="/archives" data-route class="nav-link">\uC544\uCE74\uC774\uBE0C</a>',e?'<a href="/writer" data-route class="nav-link">\uAE00\uC4F0\uAE30</a>':"",e?'<a href="/dashboard" data-route class="nav-link">\uB300\uC2DC\uBCF4\uB4DC</a>':"",'<a href="/feed.xml" class="nav-link" rel="alternate" type="application/rss+xml">RSS</a>','<a href="/sitemap.xml" class="nav-link">Sitemap</a>',e?'<a id="logout-btn" href="#" class="nav-link">\uB85C\uADF8\uC544\uC6C3</a>':'<a id="login-link" href="/login" data-route class="nav-link">\uB85C\uADF8\uC778</a>'].filter(Boolean).join("");t.innerHTML='<nav class="w-full nav-inner" role="navigation" aria-label="\uC8FC\uC694"><a href="/" data-route class="brand font-extrabold text-xl tracking-tight" aria-label="\uD648">InsureLog</a><div id="nav-links" class="header-nav mobile-nav-actions">'+o+"</div></nav>",this._navLogged=e;let c=this.normalizePath(window.location.pathname);c==="/archive"&&(c="/archives"),c==="/post"&&(c="/archives"),(c==="/home"||c==="/library")&&(c="/"),t.querySelectorAll("#nav-links a[data-route]").forEach(r=>{let p=r.getAttribute("href")||"/",h=(()=>{try{return this.normalizePath(new URL(p,window.location.origin).pathname)}catch(g){return this.normalizePath(p)}})();h==="/archive"&&(h="/archives"),(h==="/home"||h==="/library")&&(h="/"),h===c?r.setAttribute("aria-current","page"):r.removeAttribute("aria-current")});let l=DOM.$("#logout-btn");l&&(l.onclick=async r=>{var p,h;try{(p=r==null?void 0:r.preventDefault)==null||p.call(r)}catch(u){}try{this.authService?await this.authService.signOut():(h=this.supabase)!=null&&h.auth&&await this.supabase.auth.signOut(),UIComponents.showToast("\uB85C\uADF8\uC544\uC6C3\uB418\uC5C8\uC2B5\uB2C8\uB2E4.","info"),this.navigate("/")}catch(u){this.navigate("/")}})}renderHome(t=new URLSearchParams){this.switchToView("view-library");let e=DOM.$("#view-library");if(e){e.innerHTML='<section><div class="section-header"><h2 class="section-title">\uCD5C\uADFC \uAE00</h2></div><div id="home-posts" class="grid grid-cols-1 gap-2"></div><div id="home-pagination" class="flex justify-center"></div></section>';let s=Number(t.get("page")||"1"),a=s>1?`\uCD5C\uADFC \uAE00 - \uD398\uC774\uC9C0 ${s} - InsureLog`:"InsureLog - \uCD5C\uADFC \uAE00",i=s>1?`\uCD5C\uC2E0 \uAC8C\uC2DC\uAE00 \uBAA9\uB85D \xB7 \uD398\uC774\uC9C0 ${s}`:"\uCD5C\uC2E0 \uAC8C\uC2DC\uAE00 \uBAA9\uB85D";this.updatePageMeta(a,i,window.location.href,"/og-image.svg"),this.updateRobotsMeta(s===1?"index,follow":"noindex,follow"),this.loadHomePosts(t).catch(n=>this.handleError(n,"loadHomePosts"))}}renderPost(t,e="#view-post"){e==="#view-post"&&this.switchToView("view-post");let s=DOM.$(e);s&&(s.innerHTML='<article><div class="mb-6"><div class="h-8 w-2/3 bg-gray-200 animate-pulse rounded"></div></div><div class="space-y-3"><div class="h-5 bg-gray-200 animate-pulse rounded"></div><div class="h-5 bg-gray-200 animate-pulse rounded"></div></div></article>',this.loadPostDetail(t,e).catch(a=>this.handleError(a,"loadPostDetail")))}renderPostModal(t){let e=encodeURIComponent(String(t||"").trim());this.navigate(e?`/post/${e}`:"/archives")}renderArchivesModal(){this.navigate("/archives")}renderWriterModal(t){if(!this.checkAuth(!0))return;let e=String(t||"").trim(),s=e?`/writer/${encodeURIComponent(e)}`:"/writer";this.navigate(s)}renderWriter(t,e="#view-writer"){if(!this.checkAuth(!0))return;e==="#view-writer"&&this.switchToView("view-writer");let s=DOM.$(e);if(!s)return;let a=!!t;s.innerHTML=`<section class="nav-inner py-10"><div class="flex items-center justify-between"><h1 class="text-2xl font-bold">${a?"\uAE00 \uC218\uC815":"\uAE00 \uC791\uC131"}</h1><button type="button" id="btn-open-post-picker" class="btn btn-outline btn-sm">\uAE30\uC874 \uAE00 \uBD88\uB7EC\uC624\uAE30</button></div><form id="writer-form" class="mt-6 space-y-5 editor-shell"><div id="writer-errors" class="sr-only" role="alert" aria-live="assertive"></div><div><label class="block text-sm font-medium">\uC81C\uBAA9</label><input id="post-title" type="text" class="form-input" placeholder="\uC81C\uBAA9\uC744 \uC785\uB825\uD558\uC138\uC694" required aria-errormessage="writer-errors" aria-invalid="false"></div><div><label class="block text-sm font-medium">\uC694\uC57D</label><textarea id="post-summary" class="form-textarea" placeholder="\uC694\uC57D\uC744 \uC785\uB825\uD558\uC138\uC694"></textarea></div><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label class="block text-sm font-medium">\uCE74\uD14C\uACE0\uB9AC</label><input id="post-category" type="text" class="form-input" placeholder="\uC608: \uAE30\uC220"></div><div><label class="block text-sm font-medium">\uC0C1\uD0DC</label><select id="post-status" class="form-select"><option value="draft">\uCD08\uC548</option><option value="published">\uBC1C\uD589</option></select></div></div><div><label class="block text-sm font-medium">\uD0DC\uADF8</label><input id="post-tags" type="text" class="form-input" placeholder="\uD0DC\uADF8\uB97C \uC27C\uD45C\uB85C \uAD6C\uBD84\uD574 \uC785\uB825 (\uC608: \uBCF4\uD5D8,\uC790\uB3D9\uCC28,\uAC00\uC774\uB4DC)"></div><div id="tag-suggestions" class="flex flex-wrap gap-2 mt-2" aria-label="\uCD94\uCC9C \uD0DC\uADF8" aria-live="polite"></div><div><label class="block text-sm font-medium">\uC378\uB124\uC77C \uC774\uBBF8\uC9C0</label><input id="post-thumb" type="file" accept="image/*" class="form-input"/></div><div><label class="block text-sm font-medium">\uCF58\uD150\uCE20 (\uBCF5\uC0AC/\uBD99\uC5EC\uB123\uAE30 \uC9C0\uC6D0)</label><div id="editor-toolbar" class="editor-toolbar btn-group mt-2"><button type="button" data-cmd="bold" class="btn btn-outline btn-sm">\uAD75\uAC8C</button><button type="button" data-cmd="italic" class="btn btn-outline btn-sm">\uAE30\uC6B8\uC784</button><button type="button" data-cmd="underline" class="btn btn-outline btn-sm">\uBC11\uC904</button><button type="button" data-cmd="h2" class="btn btn-outline btn-sm">H2</button><button type="button" data-cmd="p" class="btn btn-outline btn-sm">\uBCF8\uBB38</button><button type="button" data-cmd="ul" class="btn btn-outline btn-sm">\uBAA9\uB85D</button><button type="button" data-cmd="ol" class="btn btn-outline btn-sm">\uBC88\uD638\uBAA9\uB85D</button><button type="button" data-cmd="quote" class="btn btn-outline btn-sm">\uC778\uC6A9</button><button type="button" data-cmd="code" class="btn btn-outline btn-sm">\uCF54\uB4DC</button><button type="button" data-cmd="link" class="btn btn-outline btn-sm">\uB9C1\uD06C</button><button type="button" data-cmd="clear" class="btn btn-outline btn-sm">\uC11C\uC2DD\uD574\uC81C</button></div><div id="post-content-editor" contenteditable="true" class="editor-surface prose-custom" placeholder="\uB2E4\uB978 \uAE00\uC744 \uBCF5\uC0AC\uD574 \uBD99\uC5EC\uB123\uC73C\uBA74 \uD615\uC2DD\uC774 \uC720\uC9C0\uB429\uB2C8\uB2E4."></div><p class="text-xs text-gray-500 mt-1">\uBD99\uC5EC\uB123\uAE30 \uC2DC \uAE30\uBCF8 \uC11C\uC2DD(\uAD75\uAC8C, \uC81C\uBAA9, \uBAA9\uB85D \uB4F1)\uC774 \uC720\uC9C0\uB429\uB2C8\uB2E4. \uC800\uC7A5 \uC2DC \uC548\uC804\uD558\uAC8C \uC815\uC81C\uB41C HTML\uB85C \uC800\uC7A5\uD569\uB2C8\uB2E4.</p></div><div class="flex items-center gap-2"><button type="submit" class="btn btn-primary">\uC800\uC7A5</button><a href="/" data-route class="btn btn-secondary">\uCDE8\uC18C</a></div></form></section>`,this.updatePageMeta(a?"\uAE00 \uC218\uC815 - InsureLog":"\uAE00 \uC791\uC131 - InsureLog",a?"\uAE30\uC874 \uAE00\uC744 \uC218\uC815\uD569\uB2C8\uB2E4.":"\uC0C8 \uAE00\uC744 \uC791\uC131\uD569\uB2C8\uB2E4.",window.location.href,"/og-image.svg"),this.renderPostPickerUI(e),a&&this.loadWriterData(t).catch(n=>this.handleError(n,"loadWriterData")),this.loadTagSuggestions().catch(n=>this.handleError(n,"loadTagSuggestions"));let i=DOM.$("#writer-form");i&&i.addEventListener("submit",async n=>{n.preventDefault(),await this.submitWriterForm(a?t:null,e)},{once:!0}),this.setupContentEditor(a?t:null)}renderPostPickerUI(t="#view-writer"){let e=DOM.$(t)||DOM.$("#writer-modal")||DOM.$("#view-writer");if(!e)return;if(!DOM.$("#post-picker-modal")){let c=document.createElement("div");c.id="post-picker-modal",c.className="hidden",c.innerHTML=`
                <div class="modal-overlay">
                    <div class="modal-content modal-content-lg">
                        <div class="modal-header">
                            <h2 class="modal-title">\uAE30\uC874 \uAE00 \uC120\uD0DD</h2>
                            <button class="modal-close" id="post-picker-close" aria-label="\uB2EB\uAE30">\u2715</button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <input type="text" id="post-picker-query" class="w-full border rounded-lg p-2" placeholder="\uC81C\uBAA9\uC73C\uB85C \uAC80\uC0C9..."/>
                            </div>
                            <div id="post-picker-list" class="space-y-2"></div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn px-4 py-2 rounded-lg border" id="post-picker-cancel">\uB2EB\uAE30</button>
                        </div>
                    </div>
                </div>`,e.appendChild(c)}let s=DOM.$("#btn-open-post-picker"),a=DOM.$("#post-picker-close"),i=DOM.$("#post-picker-cancel"),n=DOM.$("#post-picker-query");s&&(s.onclick=()=>{DOM.openModal("post-picker-modal"),this.loadPostsForPicker("")});let o=()=>DOM.closeModal("post-picker-modal");a&&(a.onclick=o),i&&(i.onclick=o),n&&(n.oninput=()=>{clearTimeout(this._postPickerTimer),this._postPickerTimer=setTimeout(()=>{this.loadPostsForPicker(n.value.trim())},200)})}async loadPostsForPicker(t=""){try{if(!this.supabase)return;let e=window.Config&&window.Config.DB_TABLE_NAME||"posts",s=this.supabase.from(e).select("id, title, slug, status, created_at").order("created_at",{ascending:!1}).limit(50);t&&(s=this.supabase.from(e).select("id, title, slug, status, created_at").ilike("title",`%${t}%`).order("created_at",{ascending:!1}).limit(50));let{data:a,error:i}=await s;if(i)throw i;let n=DOM.$("#post-picker-list");if(!n)return;if(!a||a.length===0){n.innerHTML='<div class="text-sm text-gray-600">\uAC80\uC0C9 \uACB0\uACFC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.</div>';return}n.innerHTML=a.map(o=>{let c="/writer/"+o.slug,d=this.formatDateKR(o.created_at),r=`<span class="badge">${this.statusToKor(o.status)}</span>`;return`
                    <div class="post-picker-item">
                        <div class="post-picker-main">
                            <a href="${c}" data-route class="post-picker-title">${this.escapeHTML(o.title||"\uC81C\uBAA9 \uC5C6\uC74C")}</a>
                            <div class="post-picker-meta">\uC791\uC131\uC77C ${d} \xB7 \uC0C1\uD0DC ${r}</div>
                        </div>
                        <div class="post-picker-actions">
                            <a href="${c}" data-route class="btn-xs">\uD3B8\uC9D1</a>
                        </div>
                    </div>`}).join("")}catch(e){this.handleError(e,"loadPostsForPicker")}}statusToKor(t){switch(String(t||"").toLowerCase()){case"published":return"\uACF5\uAC1C";case"private":return"\uBE44\uACF5\uAC1C";case"draft":default:return"\uC784\uC2DC"}}renderLoginModal(){let t=document.getElementById("modal-container")||document.body,e=window.Config&&window.Config.SITE_URL||window.location.origin;if(!document.getElementById("login-modal")){let a=document.createElement("div");a.id="login-modal",a.className="hidden",a.innerHTML=`
                <div class="modal-overlay">
                    <div class="modal-content modal-content-md">
                        <div class="modal-header">
                            <h3 class="modal-title">\uB85C\uADF8\uC778</h3>
                            <button class="modal-close" aria-label="\uB2EB\uAE30">\u2715</button>
                        </div>
                        <div class="modal-body">
                            <form id="magic-form" class="login-form" novalidate>
                                <div id="login-errors" class="sr-only" role="alert" aria-live="assertive"></div>
                                <div class="form-field">
                                  <label class="block text-sm font-medium" for="magic-email">\uC774\uBA54\uC77C \uC8FC\uC18C</label>
                                  <input id="magic-email" type="email" class="form-input w-full" placeholder="you@example.com" required autocomplete="email" inputmode="email" aria-describedby="magic-help login-errors" aria-errormessage="magic-error">
                                </div>
                                <div id="magic-error" class="form-error hidden" role="alert" aria-live="assertive">
                                  <span>\uC62C\uBC14\uB978 \uC774\uBA54\uC77C \uD615\uC2DD\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.</span>
                                </div>
                                <button id="magic-send" type="submit" class="btn btn-primary w-full">\uB85C\uADF8\uC778 \uB9C1\uD06C \uBCF4\uB0B4\uAE30</button>
                                <p id="magic-help" class="text-xs text-gray-500">\uBA54\uC77C\uC758 \uB9C1\uD06C\uB97C \uB204\uB974\uBA74 \uC790\uB3D9 \uB85C\uADF8\uC778\uB429\uB2C8\uB2E4. 1\uBD84 \uB0B4 \uB3C4\uCC29\uD558\uC9C0 \uC54A\uC73C\uBA74 \uC2A4\uD338\uD568\uB3C4 \uD655\uC778\uD574\uC8FC\uC138\uC694.</p>
                                <div id="magic-success" class="text-sm text-green-700 hidden" role="status" aria-live="polite">\uC774\uBA54\uC77C\uB85C \uB85C\uADF8\uC778 \uB9C1\uD06C\uB97C \uBCF4\uB0C8\uC2B5\uB2C8\uB2E4. \uBA54\uC77C\uD568\uC744 \uD655\uC778\uD574\uC8FC\uC138\uC694.</div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn px-4 py-2 rounded-lg border cancel-btn">\uB2EB\uAE30</button>
                        </div>
                    </div>
                </div>`,t.appendChild(a),this.bindModalCloseHandlers("login-modal",{onClose:()=>this.navigate("/")})}let s=DOM.$("#magic-form");if(s){if(s.dataset.bound==="true"){DOM.openModal("login-modal");return}let a=DOM.$("#magic-email"),i=DOM.$("#magic-error"),n=DOM.$("#magic-success"),o=DOM.$("#magic-send"),c=l=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(l||"").trim()),d=l=>{if(!i)return;i.classList.toggle("hidden",!l),a&&(a.classList.toggle("error",!!l),a.setAttribute("aria-invalid",l?"true":"false"));let r=DOM.$("#login-errors");r&&(r.textContent=l?"\uC62C\uBC14\uB978 \uC774\uBA54\uC77C \uD615\uC2DD\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.":"")};a==null||a.addEventListener("input",()=>d(!1)),s.addEventListener("submit",async l=>{var p;l.preventDefault();let r=String((a==null?void 0:a.value)||"").trim();if(!c(r)){d(!0),a==null||a.focus();return}if(!this.authService&&!((p=this.supabase)!=null&&p.auth))return UIComponents.showToast("\uC778\uC99D \uBAA8\uB4C8\uC744 \uCD08\uAE30\uD654\uD558\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4.","error");try{if(o==null||o.setAttribute("disabled","true"),o&&(o.textContent="\uBCF4\uB0B4\uB294 \uC911\u2026",o.setAttribute("aria-busy","true")),this.authService)await this.authService.signInWithOtp(r,e);else{let{error:h}=await this.supabase.auth.signInWithOtp({email:r,options:{shouldCreateUser:!0,emailRedirectTo:e}});if(h)throw h}UIComponents.showToast("\uB85C\uADF8\uC778 \uB9C1\uD06C\uB97C \uC774\uBA54\uC77C\uB85C \uBCF4\uB0C8\uC2B5\uB2C8\uB2E4.","success"),n&&n.classList.remove("hidden")}catch(h){try{this._logAuthEvent("login_magic_failed",{email:r})}catch(g){}UIComponents.showToast("\uBA54\uC77C \uBC1C\uC1A1\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.","error");let u=DOM.$("#login-errors");u&&(u.textContent="\uBA54\uC77C \uBC1C\uC1A1\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.")}finally{setTimeout(()=>{o==null||o.removeAttribute("disabled"),o&&(o.textContent="\uB85C\uADF8\uC778 \uB9C1\uD06C \uBCF4\uB0B4\uAE30",o.removeAttribute("aria-busy"))},1200)}}),s.dataset.bound="true"}DOM.openModal("login-modal")}render404(){this.switchToView("view-library");let t=DOM.$("#view-library");t&&(t.innerHTML='<section class="max-w-md mx-auto py-20 px-6 text-center"><h1 class="text-2xl font-extrabold">\uD398\uC774\uC9C0\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4</h1><p class="text-sm text-gray-600 mt-2">\uC694\uCCAD\uD558\uC2E0 \uD398\uC774\uC9C0\uAC00 \uC874\uC7AC\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.</p><div class="mt-6"><a href="/" data-route class="px-4 py-2 rounded-full bg-black text-white">\uD648\uC73C\uB85C</a></div></section>',this.updatePageMeta("\uD398\uC774\uC9C0\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4 - InsureLog","\uC694\uCCAD\uD55C \uD398\uC774\uC9C0\uAC00 \uC874\uC7AC\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.",window.location.href,"/og-image.svg"))}handleError(t,e=""){var a,i,n;console.error("Error in "+e+":",t);let s="\uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.";(a=t.message)!=null&&a.includes("fetch")?s="\uB124\uD2B8\uC6CC\uD06C \uC5F0\uACB0\uC744 \uD655\uC778\uD574\uC8FC\uC138\uC694.":(i=t.message)!=null&&i.includes("auth")?s="\uB85C\uADF8\uC778\uC774 \uD544\uC694\uD569\uB2C8\uB2E4.":(n=t.message)!=null&&n.includes("permission")&&(s="\uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4."),UIComponents.showToast(s,"error")}async _logAuthEvent(t,e={}){try{if(this.authService){await this.authService.logAuthEvent(t,e);return}let s={type:t,email_hint:(e.email||"").replace(/(^.).+(@.+$)/,"$1***$2"),provider:e.provider||null,user_agent:navigator&&navigator.userAgent||null,at:new Date().toISOString(),success:!1};this.supabase&&await this.supabase.from("auth_events").insert(s)}catch(s){}}setLoading(t,e="#app-container"){let s=DOM.$(e)?e:DOM.$("#modal-container")?"#modal-container":"#app-container";t?DOM.showLoading(s):DOM.hideLoading(s)}checkAuth(t=!0){return this.state.user?!0:(t&&(UIComponents.showToast("\uB85C\uADF8\uC778\uC774 \uD544\uC694\uD569\uB2C8\uB2E4.","warning"),this.navigate("/login")),!1)}updatePageMeta(t,e,s,a=null){document.title=t;let i=DOM.$('meta[name="description"]');i&&(i.content=e||"");let n=s||window.location.href,o=a||"/og-image.svg";try{o=new URL(o,window.location.origin).href}catch(x){}let c=DOM.$('link[rel="canonical"]');c&&(c.href=n);let d=DOM.$('meta[property="og:title"]'),l=DOM.$('meta[property="og:description"]'),r=DOM.$('meta[property="og:url"]'),p=DOM.$('meta[property="og:image"]');d&&(d.content=t),l&&(l.content=e||""),r&&(r.content=n),p&&(p.content=o);let h=DOM.$('meta[name="twitter:title"]'),u=DOM.$('meta[name="twitter:description"]'),g=DOM.$('meta[name="twitter:image"]'),v=DOM.$('meta[name="twitter:card"]');h&&(h.content=t),u&&(u.content=e||""),g&&(g.content=o),v&&(v.content="summary_large_image")}async loadWriterData(t){var n,o;if(!this.supabase)return;let e=window.Config&&window.Config.DB_TABLE_NAME||"posts",{data:s,error:a}=await this.supabase.from(e).select("*").eq("slug",t).maybeSingle();if(a)throw a;if(!s){let c=await this.supabase.from(e).select("*").eq("id",t).maybeSingle();if(c.error)throw c.error;s=c.data||null}if(!s)return;DOM.$("#post-title").value=s.title||"",DOM.$("#post-summary").value=s.summary||"",DOM.$("#post-category").value=s.category||"",DOM.$("#post-status").value=s.status||"draft";let i=DOM.$("#post-content-editor");if(i){let c=this.renderContentHTML((o=(n=s.refined_content)!=null?n:s.content)!=null?o:"");i.innerHTML=c;let d=Array.isArray(s.tags)&&s.tags.length?s.tags:this.extractTagsFromHTML(s.refined_content),l=DOM.$("#post-tags");l&&d.length&&(l.value=d.join(","))}}async loadTagSuggestions(){try{let t=DOM.$("#tag-suggestions");if(!t)return;t.innerHTML='<span class="text-xs text-gray-500">\uD0DC\uADF8 \uBD88\uB7EC\uC624\uB294 \uC911...</span>';let e=await fetch("/api/tags");if(!e.ok)throw new Error("\uD0DC\uADF8 \uBAA9\uB85D \uC694\uCCAD \uC2E4\uD328");let s=await e.json(),a=Array.isArray(s.tags)?s.tags.slice(0,20):[];if(!a.length){t.innerHTML='<span class="text-xs text-gray-500">\uCD94\uCC9C \uD0DC\uADF8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.</span>';return}let i=(n,o)=>{let c=document.createElement("button");return c.type="button",c.className="px-2 py-1 text-xs rounded-full border border-gray-300 hover:border-black hover:bg-gray-50",c.textContent=`${n}`,c.setAttribute("aria-label",`${n} \uD0DC\uADF8 \uCD94\uAC00 (\uBE48\uB3C4 ${o})`),c.addEventListener("click",()=>{try{let d=DOM.$("#post-tags"),l=(d.value||"").split(",").map(p=>p.trim()).filter(Boolean).map(p=>p.toLowerCase()),r=String(n||"").toLowerCase();l.includes(r)||l.push(r),d.value=l.join(", "),d.dispatchEvent(new Event("input"))}catch(d){}}),c};t.innerHTML="",a.forEach(n=>{t.appendChild(i(n.name,n.count))})}catch(t){let e=DOM.$("#tag-suggestions");e&&(e.innerHTML='<span class="text-xs text-gray-500">\uD0DC\uADF8\uB97C \uBD88\uB7EC\uC624\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4.</span>')}}async submitWriterForm(t=null,e="#view-writer"){var a,i,n;let s=DOM.$(e)?e:DOM.$("#modal-container")?"#modal-container":"#view-writer";try{if(!this.supabase)throw new Error("Supabase\uAC00 \uC900\uBE44\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4");let o=DOM.$("#writer-form"),c=o==null?void 0:o.querySelector('button[type="submit"]'),d=DOM.$("#writer-errors"),l=DOM.$("#post-title"),r=((a=l==null?void 0:l.value)==null?void 0:a.trim())||"",p=[];if(r?r.length<2&&p.push("\uC81C\uBAA9\uC740 \uCD5C\uC18C 2\uC790 \uC774\uC0C1\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4."):p.push("\uC81C\uBAA9\uC744 \uC785\uB825\uD558\uC138\uC694."),p.length){d&&(d.textContent=p.join(" "),d.classList.remove("sr-only")),l&&(l.setAttribute("aria-invalid","true"),l.setAttribute("aria-errormessage","writer-errors"),l.focus());return}else d&&(d.textContent="",d.classList.add("sr-only")),l&&l.setAttribute("aria-invalid","false");o&&o.setAttribute("aria-busy","true"),c&&(c.disabled=!0,c.setAttribute("aria-disabled","true"),c.dataset._origText=c.textContent||"",c.textContent="\uC800\uC7A5 \uC911\u2026"),this.setLoading(!0,s),await ScriptLoader.loadUtilities();let h=r,u=DOM.$("#post-summary").value.trim(),g=DOM.$("#post-category").value.trim(),v=DOM.$("#post-status").value,x=DOM.$("#post-thumb"),M=[],f=DOM.$("#post-tags"),w=((f==null?void 0:f.value)||"").trim();w&&(M=w.split(",").map(C=>C.trim()).filter(Boolean).map(C=>C.toLowerCase()));let b=DOM.$("#post-content-editor"),y="";if(b){let C=b.innerHTML||"";y=window.DOMPurify?window.DOMPurify.sanitize(C):C,y=y.replace(/<h1([^>]*)>/gi,"<h2$1>").replace(/<\/h1>/gi,"</h2>"),y=this.ensureImageAltAttributes(y,h);let A=DOM.$("#post-summary");if(A&&!A.value.trim()){let D=b.innerText||"";A.value=D.replace(/\s+/g," ").trim().slice(0,160)}}else{let C=((i=DOM.$("#post-content"))==null?void 0:i.value)||"";try{let A=JSON.parse(C);y=JSON.stringify(A)}catch(A){y=C}}let L=t||this.slugify(h);L=await this.ensureUniqueSlug(L,t);let $=null;if(x&&x.files&&x.files[0]){let C=x.files[0],A=`thumbnails/${L}.webp`;$=await this.uploadImageToBucket(C,A)}let S=window.Config&&window.Config.DB_TABLE_NAME||"posts",k=new Date().toISOString(),T={title:h,summary:u,category:g,status:v,refined_content:y,slug:L,updated_at:k,author_id:((n=this.state.user)==null?void 0:n.id)||null,tags:M};$&&(T.thumbnail_url=$);let E;if(t?E=await this.supabase.from(S).update(T).eq("slug",t).select("id").maybeSingle():(T.created_at=k,T.view_count=0,E=await this.supabase.from(S).insert(T).select("id").maybeSingle()),E.error)throw E.error;UIComponents.showToast("\uAE00\uC774 \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4.","success"),v==="published"?this.navigate("/post/"+encodeURIComponent(L)):this.navigate("/")}catch(o){let c=DOM.$("#writer-errors");c&&(c.textContent=`\uC800\uC7A5 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4: ${o.message||o}`,c.classList.remove("sr-only")),this.handleError(o,"submitWriterForm")}finally{let o=DOM.$("#writer-form"),c=o==null?void 0:o.querySelector('button[type="submit"]');o&&o.setAttribute("aria-busy","false"),c&&(c.disabled=!1,c.removeAttribute("aria-disabled"),c.dataset._origText&&(c.textContent=c.dataset._origText)),this.setLoading(!1,"#view-writer")}}slugify(t){let s=String(t||"").toLowerCase().trim().normalize("NFKD").replace(/\s+/g,"-").replace(/[^\p{L}\p{N}\-]+/gu,"").replace(/-+/g,"-").replace(/^-+|-+$/g,"");return s||(s="post-"+Date.now().toString(36)),s}async ensureUniqueSlug(t,e=null){if(!this.supabase||e&&t===e)return t;let s=window.Config&&window.Config.DB_TABLE_NAME||"posts",{data:a,error:i}=await this.supabase.from(s).select("slug").eq("slug",t).limit(1);if(i||!a||a.length===0)return t;let n=Math.random().toString(36).slice(2,6);return`${t}-${n}`}async loadPostDetail(t,e="#view-post"){let s=DOM.$(e);if(await this.ensureSupabaseReady(1200),!this.supabase){s.innerHTML='<div class="max-w-3xl mx-auto py-10 px-6 text-gray-600">\uB370\uC774\uD130 \uC18C\uC2A4\uAC00 \uC900\uBE44\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.</div>';return}let a=window.Config&&window.Config.DB_TABLE_NAME||"posts",{data:i,error:n}=await this.supabase.from(a).select("*").eq("slug",t).eq("status","published").maybeSingle();if(n)throw n;if(!i)try{let g=[],v=String(t||"");g.push(v),g.push(v.toLowerCase()),g.push(v.replace(/_/g,"-")),g.push(this.slugify(v));let x=Array.from(new Set(g.filter(M=>M&&typeof M=="string")));if(x.length){let{data:M,error:f}=await this.supabase.from(a).select("*").in("slug",x).eq("status","published").limit(1);i=M&&M[0]||null}}catch(g){}if(!i){s.innerHTML='<section class="max-w-md mx-auto py-20 px-6 text-center"><h1 class="text-2xl font-extrabold">\uAE00\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4</h1><p class="text-sm text-gray-600 mt-2">\uC694\uCCAD\uD558\uC2E0 \uAE00\uC774 \uC874\uC7AC\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.</p><div class="mt-6"><a href="/" data-route class="px-4 py-2 rounded-full bg-black text-white">\uD648\uC73C\uB85C</a></div></section>';return}try{await this.supabase.from(a).update({view_count:(i.view_count||0)+1}).eq("id",i.id)}catch(g){console.warn("view_count update \uC2E4\uD328:",g)}let o=this.escapeHTML(i.title||"\uC81C\uBAA9 \uC5C6\uC74C"),c=this.formatDate(i.created_at),d=i.category?`<span class="text-xs px-2 py-1 rounded-full bg-black/5">${this.escapeHTML(i.category)}</span>`:"",l=Array.isArray(i.tags)&&i.tags.length?i.tags:this.extractTagsFromHTML(i.refined_content),r=l&&l.length?`<div class="mt-2 flex flex-wrap gap-2">${l.map(g=>`<span class="text-xs px-2 py-1 rounded-full bg-blue-50 border border-blue-200">${this.escapeHTML(g)}</span>`).join("")}</div>`:"";await ScriptLoader.loadUtilities();let p=this.renderContentHTML(i.refined_content),h=this.state.user?`<a href="/writer/${encodeURIComponent(i.slug)}" data-route class="px-3 py-1 rounded-full border">\uC218\uC815</a>`:"";s.innerHTML=`<article class="post-detail py-10"><div class="post-detail-inner"><h1 class="post-title text-3xl font-extrabold tracking-tight">${o}</h1><div class="post-meta flex items-center"><span class="post-date">${c}</span>${d?d.replace("<span",'<span class="post-category"'):""}</div>${r?r.replace("<div",'<div class="post-tags"'):""}<div class="blog-post-content prose-custom">${p}</div></div><div class="post-detail-inner"><div class="mt-8 flex items-center gap-3"><button id="btn-like" class="px-3 py-1 rounded-full border">\uC88B\uC544\uC694 <span id="like-count"></span></button><button id="btn-share" class="px-3 py-1 rounded-full border">\uACF5\uC720</button><button id="btn-copy" class="px-3 py-1 rounded-full border">\uB9C1\uD06C\uBCF5\uC0AC</button>${h}</div><div id="related-posts" class="mt-12"></div><div id="popular-posts" class="mt-12"></div></div></article>`;let u=i.thumbnail_url?this.getTransformedPublicUrl(i.thumbnail_url,{width:1200,height:630,resize:"cover",quality:85,format:"webp"}):"/og-image.svg";this.updatePageMeta(i.title,i.summary||"",window.location.href,u);try{let g="likes:"+(i.slug||i.id),v=DOM.$("#like-count"),x=DOM.$("#btn-like"),M=DOM.$("#btn-share"),f=DOM.$("#btn-copy"),w=Number(localStorage.getItem(g)||"0");v&&(v.textContent=String(w)),x&&x.addEventListener("click",()=>{w+=1,localStorage.setItem(g,String(w)),v&&(v.textContent=String(w))}),M&&M.addEventListener("click",async()=>{try{navigator.share?await navigator.share({title:i.title,text:i.summary||"",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),UIComponents.showToast("\uB9C1\uD06C\uAC00 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.","success"))}catch(b){}}),f&&f.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(window.location.href),UIComponents.showToast("\uB9C1\uD06C\uAC00 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.","success")}catch(b){}})}catch(g){}this.loadRelatedPosts(i).catch(g=>this.handleError(g,"loadRelatedPosts")),this.loadPopularPosts(i.id).catch(g=>this.handleError(g,"loadPopularPosts"))}renderContentHTML(t){if(!t)return'<p class="text-gray-600">\uCF58\uD150\uCE20\uAC00 \uC544\uC9C1 \uC900\uBE44\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.</p>';try{let a=typeof t=="string"?JSON.parse(t):t;if(a&&Array.isArray(a.blocks)){this._contentFirstImageEagerDone=!1;let i=a.blocks.map(n=>this.renderEditorBlock(n)).join("");return this.dedupeConsecutiveImages(i)}if(a&&a.ops&&Array.isArray(a.ops)){let i=a.ops.map(d=>{let l=typeof d.insert=="string"?this.escapeHTML(d.insert):"",r=d.attributes||{},p=l;return r.bold&&(p=`<strong>${p}</strong>`),r.italic&&(p=`<em>${p}</em>`),r.underline&&(p=`<u>${p}</u>`),p}).join(""),n=window.DOMPurify?window.DOMPurify.sanitize(i):i,o=this.transformPlainImagesToOptimized(n),c=this.ensureImageAltAttributes(o,"");return this.dedupeConsecutiveImages(c)}}catch(a){}let e=typeof t=="string";if(e&&(/!\[[^\]]*\]\([^)]+\)/.test(t)||/\[[^\]]+\]\([^)]+\)/.test(t)||/(^|\n)\s{0,3}#{1,6}\s/.test(t)||/(^|\n)\s{0,3}[-*]\s+/.test(t)||/(^|\n)\s{0,3}\d+\.\s+/.test(t))&&window.marked){let a=e?t:String(t),i=this.preprocessPlainTextToMarkdown(a),n=window.marked.parse(i),o=window.DOMPurify?window.DOMPurify.sanitize(n):n,c=this.transformPlainImagesToOptimized(o),d=this.ensureImageAltAttributes(c,"");return this.dedupeConsecutiveImages(d)}if(e&&/<\w+[^>]*>/i.test(t)){let a=t,i=window.DOMPurify?window.DOMPurify.sanitize(a):a,n=this.transformPlainImagesToOptimized(i),o=this.ensureImageAltAttributes(n,"");return this.dedupeConsecutiveImages(o)}if(window.marked){let a=e?t:String(t),i=this.preprocessPlainTextToMarkdown(a),n=window.marked.parse(i),o=window.DOMPurify?window.DOMPurify.sanitize(n):n,c=this.transformPlainImagesToOptimized(o),d=this.ensureImageAltAttributes(c,"");return this.dedupeConsecutiveImages(d)}return`<pre>${this.escapeHTML(typeof t=="string"?t:JSON.stringify(t))}</pre>`}renderEditorBlock(t){var a;let e=t.type,s=t.data||{};switch(e){case"paragraph":return`<p>${this.escapeHTML(s.text||"")}</p>`;case"header":return`<h${s.level||2}>${this.escapeHTML(s.text||"")}</h${s.level||2}>`;case"list":let i=(s.items||[]).map(n=>`<li>${this.escapeHTML(n)}</li>`).join("");return s.style==="ordered"?`<ol>${i}</ol>`:`<ul>${i}</ul>`;case"quote":return`<blockquote>${this.escapeHTML(s.text||"")}</blockquote>`;case"image":if((a=s.file)!=null&&a.url){let n=this.escapeHTML(s.caption||""),o=navigator&&navigator.connection?navigator.connection:{},c=!!o.saveData,d=o.effectiveType||"",l=c||/(^|[^a-z])(2g|3g)/.test(d),r=l?[360,600]:[480,768,1200],p=l?900:1200,h=l?75:85,u=l?60:80,g=l?"(max-width: 600px) 100vw, 600px":"(max-width: 768px) 100vw, 768px",v=this.getOptimizedPublicUrl(s.file.url,{width:p,quality:h,format:"webp"}),x=r.map(L=>`${this.getOptimizedPublicUrl(s.file.url,{width:L,quality:u,format:"webp"})} ${L}w`).join(", "),M=s.width&&s.height?` width="${s.width}" height="${s.height}"`:"",f=!s.width||!s.height?' class="aspect-16-9"':"",w=!this._contentFirstImageEagerDone;if(w){this._contentFirstImageEagerDone=!0;try{if(!document.querySelector(`link[rel="preload"][as="image"][href="${v}"]`)){let $=document.createElement("link");$.rel="preload",$.as="image",$.href=v,x&&$.setAttribute("imagesrcset",x),$.setAttribute("imagesizes",g),$.crossOrigin="anonymous",document.head.appendChild($)}try{let $=new URL(v,window.location.origin).origin;if(!document.querySelector(`link[rel="preconnect"][href="${$}"]`)){let k=document.createElement("link");k.rel="preconnect",k.href=$,k.crossOrigin="anonymous",document.head.appendChild(k)}}catch($){}}catch(L){}}return`<figure><img src="${v}" srcset="${x}" sizes="${g}" alt="${n}"${w?"":' loading="lazy"'}${w?' fetchpriority="high"':' fetchpriority="low"'} decoding="async"${M}${f}/><figcaption>${n}</figcaption></figure>`}return"";case"code":return`<pre><code>${this.escapeHTML(s.code||"")}</code></pre>`;default:return""}}setupContentEditor(t=null){let e=DOM.$("#post-content-editor"),s=DOM.$("#editor-toolbar");if(!e)return;e.setAttribute("role","textbox"),e.setAttribute("aria-label","\uCF58\uD150\uCE20 \uD3B8\uC9D1\uAE30"),this._lastSelectionRange=null,e.addEventListener("focus",()=>document.execCommand("defaultParagraphSeparator",!1,"p"));let a=()=>{if(!s)return;let i=(n,o)=>{let c=s.querySelector(`button[data-cmd="${n}"]`);c&&c.classList.toggle("bg-black text-white",!!o)};try{i("bold",document.queryCommandState("bold")),i("italic",document.queryCommandState("italic")),i("underline",document.queryCommandState("underline"));let n=document.queryCommandValue("formatBlock");i("h1",/H1/i.test(n)),i("h2",/H2/i.test(n)),i("p",/P/i.test(n))}catch(n){}};if(document.addEventListener("selectionchange",()=>{if(document.activeElement===e){let i=window.getSelection();i&&i.rangeCount&&(this._lastSelectionRange=i.getRangeAt(0)),a()}}),s){let i=n=>{n.target.closest("[data-cmd]")&&n.preventDefault()};s.addEventListener("pointerdown",i,{passive:!1}),s.addEventListener("mousedown",i,{passive:!1}),s.addEventListener("touchstart",i,{passive:!1}),s.addEventListener("click",n=>{let o=n.target.closest("[data-cmd]");if(!o)return;let c=o.getAttribute("data-cmd");e.focus();let d=window.getSelection();if(d&&this._lastSelectionRange)try{d.removeAllRanges(),d.addRange(this._lastSelectionRange)}catch(l){}this.execEditorCommand(c),a()})}e.addEventListener("keydown",i=>{(i.ctrlKey||i.metaKey)&&(i.key.toLowerCase()==="b"&&(i.preventDefault(),this.execEditorCommand("bold"),a()),i.key.toLowerCase()==="i"&&(i.preventDefault(),this.execEditorCommand("italic"),a()),i.key.toLowerCase()==="u"&&(i.preventDefault(),this.execEditorCommand("underline"),a()),i.shiftKey&&i.key==="1"&&(i.preventDefault(),this.execEditorCommand("h2"),a()),i.shiftKey&&i.key==="2"&&(i.preventDefault(),this.execEditorCommand("h2"),a()))}),e.addEventListener("dragover",i=>{i.preventDefault()}),e.addEventListener("drop",async i=>{var o;i.preventDefault();let n=(o=i.dataTransfer)==null?void 0:o.files;n&&n.length&&await this.handleEditorFiles(n,t)}),e.addEventListener("paste",async i=>{var c;let n=((c=i.clipboardData)==null?void 0:c.items)||[],o=[];for(let d of n)if(d.kind==="file"){let l=d.getAsFile();l&&l.type.startsWith("image/")&&o.push(l)}o.length?(i.preventDefault(),await this.handleEditorFiles(o,t)):setTimeout(()=>{this.linkifyElementContent(e)},0)}),e.addEventListener("click",i=>{let n=i.target.closest("figcaption");n&&(n.setAttribute("contenteditable","true"),n.focus())}),e.addEventListener("input",i=>{let n=i.target.closest("figcaption");if(n){let o=n.closest("figure"),c=o?o.querySelector("img"):null;if(c){let d=n.textContent.trim();c.setAttribute("alt",d||c.getAttribute("alt")||"")}}clearTimeout(this._linkifyTimer),this._linkifyTimer=setTimeout(()=>{this.linkifyElementContent(e)},200)}),e.addEventListener("blur",i=>{i.target&&i.target.matches("figcaption")&&i.target.removeAttribute("contenteditable")},!0)}execEditorCommand(t){switch(t){case"bold":document.execCommand("bold");break;case"italic":document.execCommand("italic");break;case"underline":document.execCommand("underline");break;case"h1":document.execCommand("formatBlock",!1,"h2");break;case"h2":document.execCommand("formatBlock",!1,"h2");break;case"p":document.execCommand("formatBlock",!1,"p");break;case"ul":document.execCommand("insertUnorderedList");break;case"ol":document.execCommand("insertOrderedList");break;case"quote":document.execCommand("formatBlock",!1,"blockquote");break;case"code":this.insertHTMLAtCursor("<pre><code></code></pre>");break;case"link":{let e=prompt("\uB9C1\uD06C URL\uC744 \uC785\uB825\uD558\uC138\uC694");e&&document.execCommand("createLink",!1,e);break}case"clear":document.execCommand("removeFormat");break;default:break}}insertHTMLAtCursor(t){document.execCommand("insertHTML",!1,t)}linkifyElementContent(t){try{if(!t)return;let e=/(?:https?:\/\/[^\s<]+|www\.[^\s<]+)$/g,s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),a=[],i;for(;i=s.nextNode();){let n=i.parentElement;if(!n||n.closest("a"))continue;let o=i.nodeValue||"";/(https?:\/\/|www\.)/.test(o)&&a.push(i)}a.forEach(n=>{let o=n.nodeValue||"",c=[],d=[],l=0;if(o.replace(/(?:https?:\/\/[^\s<]+|www\.[^\s<]+)/g,(p,h)=>(c.push(o.slice(l,h)),d.push(p),l=h+p.length,p)),c.push(o.slice(l)),d.length===0)return;let r=document.createDocumentFragment();for(let p=0;p<c.length;p++){let h=c[p];h&&r.appendChild(document.createTextNode(h));let u=d[p];if(u){let g=u.startsWith("www.")?"https://"+u:u,v=document.createElement("a");v.href=g,v.textContent=u,v.rel="noopener noreferrer",v.target="_blank",r.appendChild(v)}}n.parentNode.replaceChild(r,n)})}catch(e){console.warn("linkifyElementContent error",e)}}async handleEditorFiles(t,e){try{for(let s=0;s<t.length;s++){let a=t.item?t.item(s):t[s];if(!a||!a.type.startsWith("image/"))continue;let i=`img_${Date.now()}_${s}.webp`,n=`content-images/${i}`,{savedPath:o,width:c,height:d}=await this.uploadImageToBucket(a,n),l=navigator&&navigator.connection?navigator.connection:{},r=!!l.saveData,p=l.effectiveType||"",h=r||/(^|[^a-z])(2g|3g)/.test(p),u=h?900:1200,g=h?75:85,v=h?60:80,x=this.getTransformedPublicUrl(o,{width:u,quality:g,format:"webp"}),M=this.deriveAltFromFileName(a.name||i),w=(h?[360,600]:[480,768,1200]).map(L=>`${this.getTransformedPublicUrl(o,{width:L,quality:v,format:"webp"})} ${L}w`).join(", "),b=h?"(max-width: 600px) 100vw, 600px":"(max-width: 768px) 100vw, 768px",y=c&&d?` width="${c}" height="${d}"`:"";this.insertHTMLAtCursor(`<figure><img src="${x}" srcset="${w}" sizes="${b}" alt="${this.escapeHTML(M)}" loading="lazy" decoding="async"${y}/><figcaption>${this.escapeHTML(M)}</figcaption></figure>`)}}catch(s){this.handleError(s,"handleEditorFiles")}}extractTagsFromHTML(t){try{let e=typeof t=="string"?t:String(t||""),s=document.createElement("div");s.innerHTML=e;let a=s.querySelector("[data-tags]");return((a==null?void 0:a.getAttribute("data-tags"))||"").split(",").map(n=>n.trim()).filter(Boolean)}catch(e){return[]}}async loadRelatedPosts(t){if(!this.supabase)return;let e=window.Config&&window.Config.DB_TABLE_NAME||"posts",{data:s,error:a}=await this.supabase.from(e).select("id, title, summary, slug, category, thumbnail_url, created_at").eq("status","published").neq("id",t.id).eq("category",t.category).order("created_at",{ascending:!1}).limit(3);if(a)throw a;let i=DOM.$("#related-posts");if(!i)return;if(!s||s.length===0){i.innerHTML="";return}let n=s.map(o=>{let c="/post/"+encodeURIComponent(o.slug||o.id),d=!!o.thumbnail_url,l=d?(()=>{let u=[96,120,144,160],g="(max-width: 640px) 96px, 120px",v=this.getTransformedPublicUrl(o.thumbnail_url,{width:120,height:120,resize:"cover",quality:80,format:"webp"}),x=u.map(M=>`${this.getTransformedPublicUrl(o.thumbnail_url,{width:M,height:M,resize:"cover",quality:80,format:"webp"})} ${M}w`).join(", ");return`<img src="${v}" srcset="${x}" sizes="${g}" alt="${this.escapeHTML(o.title||"")}" class="post-card-thumb-img" width="120" height="120" decoding="async" loading="lazy"/>`})():`<span class="thumb-initial">${this.escapeHTML(String(o.title||"N").trim().charAt(0).toUpperCase())}</span>`;return`<article class="post-card post-card-compact"><a href="${c}" data-route class="post-card-thumb${d?"":" placeholder"}">${l}</a><div class="post-card-main"><h3 class="post-card-title"><a href="${c}" data-route>${this.escapeHTML(o.title)}</a></h3><p class="post-card-meta">${this.formatDate(o.created_at)}</p></div></article>`}).join("");i.innerHTML=`<h2 class="text-lg font-bold mb-3">\uAD00\uB828 \uAE00</h2><div class="grid grid-cols-1 sm:grid-cols-2 gap-4">${n}</div>`}async loadPopularPosts(t=null){let e=DOM.$("#popular-posts");if(!e||!this.supabase)return;let s=window.Config&&window.Config.DB_TABLE_NAME||"posts",a=Date.now();this._reqTokens.popular=a;let i=`popular:${t||""}`,{data:n,error:o}=await this.withDedupe(i,()=>this.supabase.from(s).select("id, title, slug, thumbnail_url, created_at, view_count").eq("status","published").order("view_count",{ascending:!1,nullsFirst:!1}).limit(5));if(o)throw o;let c=(n||[]).filter(r=>r&&r.id!==t);if(!c||c.length===0){e.innerHTML="";return}if(this._reqTokens.popular!==a)return;let d='<h2 class="text-lg font-bold mb-3">\uB9CE\uC774 \uBCF8 \uAE00</h2>',l=c.map((r,p)=>{let h="/post/"+encodeURIComponent(r.slug||r.id),u=Number(r.view_count||0),g=this.formatDateKR(r.created_at);return`<li class="popular-item"><span class="popular-rank">${p+1}</span><a class="popular-link" href="${h}" data-route>${this.escapeHTML(r.title||"")}</a><span class="popular-date">${g}</span><span class="popular-views">${u.toLocaleString("ko-KR")}</span></li>`}).join("");e.innerHTML=d+`<ul class="popular-list">${l}</ul>`}deriveAltFromFileName(t=""){try{let e=String(t||"").replace(/\.[a-z0-9]+$/i,"");return e=decodeURIComponent(e),e=e.replace(/[_\-]+/g," ").replace(/\s+/g," ").trim(),e||"\uC774\uBBF8\uC9C0"}catch(e){return"\uC774\uBBF8\uC9C0"}}ensureImageAltAttributes(t,e=""){try{let s=document.createElement("div");return s.innerHTML=String(t||""),s.querySelectorAll("img").forEach(i=>{if((i.getAttribute("alt")||"").trim())return;let o="",c=i.closest("figure"),d=c?c.querySelector("figcaption"):null;if(o=((d==null?void 0:d.textContent)||"").trim(),o||(o=String(e||"").trim()),!o){let l=i.getAttribute("src")||"";try{let p=(new URL(l,window.location.origin).pathname.split("/").pop()||"").split("?")[0];o=this.deriveAltFromFileName(p)}catch(r){let p=(l.split("/").pop()||"").split("?")[0];o=this.deriveAltFromFileName(p)}}i.setAttribute("alt",o||"\uC774\uBBF8\uC9C0"),d&&!d.textContent.trim()&&(d.textContent=o||"\uC774\uBBF8\uC9C0")}),s.innerHTML}catch(s){return t}}preprocessPlainTextToMarkdown(t=""){try{let e=String(t||"");return e=e.replace(/^\s*h([1-6])\s+(.+)$/gmi,(s,a,i)=>`${"#".repeat(Number(a))} ${i}`),e=e.replace(/(^|\s)(https?:\/\/[^\s]+\.(?:png|jpe?g|webp|gif|svg))(?!\S)/gmi,(s,a,i)=>`${a}![](${i})`),e}catch(e){return String(t||"")}}transformPlainImagesToOptimized(t,e=""){try{let s=document.createElement("div");s.innerHTML=String(t||"");let a=navigator&&navigator.connection?navigator.connection:{},i=!!a.saveData,n=a.effectiveType||"",o=i||/(^|[^a-z])(2g|3g)/.test(n),c=o?[360,600]:[480,768,1200],d=o?900:1200,l=o?75:85,r=o?60:80,p=o?"(max-width: 600px) 100vw, 600px":"(max-width: 768px) 100vw, 768px";return Array.from(s.querySelectorAll("img")).forEach((u,g)=>{if(u.hasAttribute("srcset"))return;let v=u.getAttribute("src")||"";if(!v)return;let M=(u.getAttribute("alt")||"").trim()||(()=>{try{let T=(new URL(v,window.location.origin).pathname.split("/").pop()||"").split("?")[0];return this.deriveAltFromFileName(T)}catch(k){let T=(v.split("/").pop()||"").split("?")[0];return this.deriveAltFromFileName(T)}})()||e||"\uC774\uBBF8\uC9C0",f=this.getOptimizedPublicUrl(v,{width:d,quality:l,format:"webp"}),w=c.map(k=>`${this.getOptimizedPublicUrl(v,{width:k,quality:r,format:"webp"})} ${k}w`).join(", "),b=document.createElement("figure"),y=u.cloneNode(!0);y.setAttribute("src",f),y.setAttribute("srcset",w),y.setAttribute("sizes",p),y.setAttribute("alt",M),g===0?(y.removeAttribute("loading"),y.setAttribute("fetchpriority","high")):(y.setAttribute("loading","lazy"),y.setAttribute("fetchpriority","low")),y.setAttribute("decoding","async"),b.appendChild(y);let $=document.createElement("figcaption");$.textContent=M,b.appendChild($);let S=u.parentElement;S&&S.tagName.toLowerCase()==="p"?S.replaceWith(b):u.replaceWith(b)}),s.innerHTML}catch(s){return t}}dedupeConsecutiveImages(t){try{let e=document.createElement("div");e.innerHTML=String(t||"");let s=i=>`${i.getAttribute("src")||""}|${i.getAttribute("srcset")||""}`,a=Array.from(e.querySelectorAll("figure, img")).filter(i=>!(i.tagName.toLowerCase()==="img"&&i.closest("figure")));for(let i=0;i<a.length;i++){let n=a[i],o=n.tagName.toLowerCase()==="img"?n:n.querySelector("img");if(!o)continue;let c=n.previousElementSibling;if(!c)continue;let d=c.tagName.toLowerCase()==="img"?c:c.querySelector&&c.querySelector("img");if(!d)continue;s(o)===s(d)&&n.remove()}return e.innerHTML}catch(e){return t}}getOptimizedPublicUrl(t,e={}){try{let s=new URL(t,window.location.origin);if(!/supabase\.co\/.+\/object\/public\//.test(s.href))return t;let i=new URLSearchParams;e.width&&i.set("width",String(e.width)),e.height&&i.set("height",String(e.height)),e.resize&&i.set("resize",String(e.resize)),e.format&&i.set("format",String(e.format)),e.quality&&i.set("quality",String(e.quality));let n=i.toString();return n?s.search&&s.search.length>1?`${s.href}&${n}`:`${s.href}?${n}`:s.href}catch(s){return t}}getTransformedPublicUrl(t,e={}){var s;try{if(!t)return"";if(/^https?:\/\//i.test(t))return this.getOptimizedPublicUrl(t,e);let a=window.Config&&window.Config.IMAGE_BUCKET_NAME||"thought-images",i=this.supabase.storage.from(a).getPublicUrl(t,{transform:{width:e.width,height:e.height,resize:e.resize,format:e.format,quality:e.quality}});return((s=i==null?void 0:i.data)==null?void 0:s.publicUrl)||""}catch(a){return""}}async loadHomePosts(t=new URLSearchParams){let e=DOM.$("#home-posts");if(!e)return;let s=Number(t.get("page")||"1");e.innerHTML='<div class="animate-pulse space-y-3"><div class="h-6 bg-gray-200 rounded"></div><div class="h-24 bg-gray-200 rounded"></div><div class="h-24 bg-gray-200 rounded"></div></div>';let a=t.get("scenario");if(a==="empty"){e.innerHTML='<div class="text-gray-500">\uD45C\uC2DC\uD560 \uAC8C\uC2DC\uAE00\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.</div>';return}if(a==="error"){e.innerHTML='<div class="text-red-600"><p class="font-semibold">\uAC8C\uC2DC\uAE00\uC744 \uBD88\uB7EC\uC624\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4.</p><p class="text-sm text-red-500">\uC9C4\uB2E8 \uC2DC\uB098\uB9AC\uC624\uC5D0 \uC758\uD574 \uC624\uB958\uAC00 \uAC15\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.</p></div>';return}if(await this.ensureSupabaseReady(1200),!this.supabase)return;let i=window.Config&&window.Config.POSTS_PER_PAGE||10,n=(s-1)*i,o=n+i-1,c=window.Config&&window.Config.DB_TABLE_NAME||"posts",d=Date.now();this._reqTokens.home=d;let l=`home:${n}-${o}`;try{let{data:r,count:p,error:h}=await this.withDedupe(l,()=>this.supabase.from(c).select("id, title, summary, slug, category, thumbnail_url, created_at",{count:"exact"}).eq("status","published").order("created_at",{ascending:!1}).range(n,o));if(h)throw h;if(!r||r.length===0){e.innerHTML='<div class="text-gray-500">\uD45C\uC2DC\uD560 \uAC8C\uC2DC\uAE00\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.</div>';let u=DOM.$("#home-pagination");u&&(u.innerHTML="");return}try{let u=DOM.$("#home-pagination");if(u){let g=Math.max(1,Math.ceil((p||0)/i));if(g<=1)u.innerHTML="",this.updatePrevNextLinks(1,1),this.updateRobotsMeta("index,follow"),this.updatePageMeta("InsureLog - \uCD5C\uADFC \uAE00","\uCD5C\uC2E0 \uAC8C\uC2DC\uAE00 \uBAA9\uB85D",window.location.href,"/og-image.svg");else{let v=(S,k=null,T=!1)=>`<button data-page="${S}" ${T?'aria-current="page"':""} aria-label="${k||`\uD398\uC774\uC9C0 ${S}`}" class="px-3 py-1 rounded border ${T?"bg-black text-white":"hover:bg-black/5"}">${k||S}</button>`,x=s>1?v(s-1,"\uC774\uC804"):'<span class="px-3 py-1 text-gray-400" aria-hidden="true">\uC774\uC804</span>',M=s<g?v(s+1,"\uB2E4\uC74C"):'<span class="px-3 py-1 text-gray-400" aria-hidden="true">\uB2E4\uC74C</span>',f=5,w=Math.max(1,s-Math.floor(f/2)),b=Math.min(g,w+f-1),y=[];for(let S=w;S<=b;S++)y.push(v(S,null,S===s));u.innerHTML=x+y.join("")+M,u.querySelectorAll("button[data-page]").forEach(S=>{S.onclick=()=>{let k=Number(S.getAttribute("data-page"))||1;this.navigate(`/?page=${k}`)}}),this.updatePrevNextLinks(g,s),this.updateRobotsMeta(s===1?"index,follow":"noindex,follow");let L=s>1?`\uCD5C\uADFC \uAE00 - \uD398\uC774\uC9C0 ${s} - InsureLog`:"InsureLog - \uCD5C\uADFC \uAE00",$=s>1?`\uCD5C\uC2E0 \uAC8C\uC2DC\uAE00 \uBAA9\uB85D \xB7 \uD398\uC774\uC9C0 ${s}`:"\uCD5C\uC2E0 \uAC8C\uC2DC\uAE00 \uBAA9\uB85D";this.updatePageMeta(L,$,window.location.href,"/og-image.svg")}}}catch(u){}if(this._reqTokens.home!==d)return;e.innerHTML=this.renderPostsListHTML(r);try{let u=Array.from(e.querySelectorAll(".post-card-thumb-img"));if(u.length){let g=u.find(v=>{let x=v.getBoundingClientRect();return x&&x.height>0&&x.top>=0&&x.top<(window.innerHeight||0)*.9})||u[0];if(g){g.getAttribute("loading")==="lazy"&&g.removeAttribute("loading"),g.setAttribute("fetchpriority","high");let v=g.currentSrc||g.getAttribute("src"),x=g.getAttribute("srcset")||"",M=g.getAttribute("sizes")||"";if(v){if(!document.querySelector(`link[rel="preload"][as="image"][href="${v}"]`)){let w=document.createElement("link");w.rel="preload",w.as="image",w.href=v,x&&w.setAttribute("imagesrcset",x),M&&w.setAttribute("imagesizes",M),w.crossOrigin="anonymous",document.head.appendChild(w)}try{let w=new URL(v,window.location.origin).origin;if(!document.querySelector(`link[rel="preconnect"][href="${w}"]`)){let y=document.createElement("link");y.rel="preconnect",y.href=w,y.crossOrigin="anonymous",document.head.appendChild(y)}}catch(w){}}}}}catch(u){}}catch(r){let p=r&&(r.message||r.msg)?String(r.message||r.msg):"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958",h=r&&(r.status||r.code)?String(r.status||r.code):"";e.innerHTML='<div class="error-banner"><div class="error-banner-content"><svg class="error-banner-icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zm1 11H9v2h2v-2zm0-8H9v6h2V5z"/></svg><div class="error-banner-text"><div class="error-banner-title">\uAC8C\uC2DC\uAE00\uC744 \uBD88\uB7EC\uC624\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4.</div><div class="error-banner-message">\uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574 \uC8FC\uC138\uC694.'+(h?" ("+this.escapeHTML(h)+")":"")+'</div><div class="error-details">'+this.escapeHTML(p)+"</div></div></div></div>",this.handleError(r,"loadHomePosts")}}renderPostsListHTML(t){return t.map((e,s)=>{let a="/post/"+encodeURIComponent(e.slug||e.id),i=navigator&&navigator.connection?navigator.connection:{},n=!!i.saveData,o=i.effectiveType||"",c=n||/(^|[^a-z])(2g|3g)/.test(o),d=280,l=Math.round(d*(9/16)),r=c?70:80,p=c?[d]:[d,d*2],h="(max-width: 640px) 100vw, 280px",u=e.thumbnail_url?this.getTransformedPublicUrl(e.thumbnail_url,{width:d,height:l,resize:"cover",quality:r,format:"webp"}):null,g=e.thumbnail_url?p.map(S=>`${this.getTransformedPublicUrl(e.thumbnail_url,{width:S,height:Math.round(S*(l/d)),resize:"cover",quality:r,format:"webp"})} ${S}w`).join(", "):"",v=s===0,x=v?"":' loading="lazy"',M=v?' fetchpriority="high"':' fetchpriority="low"';if(v&&u)try{if(!document.querySelector(`link[rel="preload"][as="image"][href="${u}"]`)){let k=document.createElement("link");k.rel="preload",k.as="image",k.href=u,g&&k.setAttribute("imagesrcset",g),k.setAttribute("imagesizes",h),k.crossOrigin="anonymous",document.head.appendChild(k)}}catch(S){}let f=u?`<img src="${u}"${g?` srcset="${g}" sizes="${h}"`:""} alt="${this.escapeHTML(e.title||"")}" class="post-card-thumb-img" width="${d}" height="${l}" decoding="async"${x}${M}/>`:"",w=this.escapeHTML(String(e.title||"N").trim().charAt(0).toUpperCase()),b=`<a href="${a}" data-route class="post-card-thumb${u?"":" placeholder"}">${u?f:`<span class="thumb-initial">${w}</span>`}</a>`,y=this.formatDateKR(e.created_at),L=e.category?`<span class="badge">${this.escapeHTML(e.category)}</span>`:"",$=this.state.user?`<a href="/writer/${encodeURIComponent(e.slug)}" data-route class="btn-xs">\uD3B8\uC9D1</a>`:"";return'<article class="post-card post-card-wide" data-route data-href="'+a+`" tabindex="0"><h2 class="post-card-title"><a href="${a}" data-route>${this.escapeHTML(e.title||"\uC81C\uBAA9 \uC5C6\uC74C")}</a></h2><div class="post-card-content-grid"><div class="post-card-summary-block">`+(e.summary?`<p class="post-card-summary">${this.escapeHTML(e.summary)}</p>`:"")+`<div class="post-card-meta">\uC791\uC131\uC77C ${y}${e.category?` \xB7 \uCE74\uD14C\uACE0\uB9AC ${L}`:""}</div><div class="post-card-actions">${$}</div></div>`+b+"</div></article>"}).join("")}formatDateKR(t){try{let e=new Date(t),s=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${s}.${a}.${i}`}catch(e){return""}}formatDate(t){try{return new Date(t).toLocaleDateString("ko-KR",{year:"numeric",month:"short",day:"numeric"})}catch(e){return""}}escapeHTML(t){return String(t||"").replace(/[&<>"]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[e])}async logSiteVisit(){try{let{error:t}=await this.supabase.from("site_visits").insert({visited_at:new Date().toISOString()});if(t)throw t}catch(t){console.warn("site_visits insert \uC2E4\uD328:",t.message||t)}}async uploadImageToBucket(t,e){let s=window.Config&&window.Config.IMAGE_BUCKET_NAME||"thought-images",{blob:a,width:i,height:n}=await this.convertToWebP(t),{error:o}=await this.supabase.storage.from(s).upload(e,a,{contentType:"image/webp",upsert:!0});if(o)throw o;return{savedPath:e,width:i,height:n}}async convertToWebP(t){if(t.type==="image/webp"){let n=await this.readImageFromFile(t);return{blob:t,width:n.width,height:n.height}}let e=await this.readImageFromFile(t),s=document.createElement("canvas");return s.width=e.width,s.height=e.height,s.getContext("2d").drawImage(e,0,0),{blob:await new Promise(n=>s.toBlob(n,"image/webp",.9)),width:e.width,height:e.height}}readImageFromFile(t){return new Promise((e,s)=>{let a=URL.createObjectURL(t),i=new Image;i.onload=()=>{URL.revokeObjectURL(a),e(i)},i.onerror=s,i.src=a})}};window.BlogApp=H;(function(){let m={maxWidth:"auto",paddingX:24,gap:16,marginY:40,imageMargin:16,tolerance:16},t=640,e=!!(window.Config&&window.Config.DEBUG_LAYOUT===!0),s=(f,w=document)=>w.querySelector(f),a=(f,w=document)=>Array.from(w.querySelectorAll(f)),i=null,n=null;function o(){let f=s("#main-nav-container nav");if(!f)return null;let w=f.getBoundingClientRect();return Math.round(w.width)}function c(f){if(!f||!Number.isFinite(f))return;let w=getComputedStyle(document.documentElement).getPropertyValue("--content-max-width").trim(),b=f+"px";w!==b&&document.documentElement.style.setProperty("--content-max-width",b)}function d(f){if(!f)return;let w=getComputedStyle(document.documentElement).getPropertyValue("--content-max-width").trim();if(!w)return;let b=window.innerWidth<=t;if(f.style.maxWidth!==w&&(f.style.maxWidth=w),f.style.marginLeft!=="auto"&&(f.style.marginLeft="auto"),f.style.marginRight!=="auto"&&(f.style.marginRight="auto"),!b){let y=getComputedStyle(f),L=parseInt(y.paddingLeft,10)||0,$=parseInt(y.paddingRight,10)||0;L===0&&!f.style.paddingLeft&&(f.style.paddingLeft=m.paddingX+"px"),$===0&&!f.style.paddingRight&&(f.style.paddingRight=m.paddingX+"px")}}function l(f){a("img",f||document).forEach(b=>{b.closest(".post-card")||b.classList.contains("post-card-thumb-img")||b.dataset.centered!=="1"&&(b.style.display="block",b.style.margin=`${m.imageMargin}px auto`,b.style.maxWidth="100%",b.style.height="auto",b.dataset.centered="1")})}function r(){let f=[],w=s("#view-library > section");w&&f.push(w);let b=s("#view-post > article");b&&f.push(b);let y=s("#view-archives > section");y&&f.push(y);let L=s("#view-writer > section");L&&f.push(L);let $=S=>!!S&&S.offsetParent!==null&&getComputedStyle(S).display!=="none"&&S.getBoundingClientRect().width>0;return f.filter($)}function p(){let f=o(),w=r(),b=[];return e&&(w.forEach(y=>{let L=y.getBoundingClientRect(),$=document.documentElement.clientWidth||window.innerWidth,S=$<=t,k=Math.round(L.left),T=Math.round($-L.right),E=Math.abs(k-T)<=m.tolerance,C=S?!0:f?Math.abs(Math.round(L.width)-f)<=m.tolerance:!0,A=[];if(Math.round(L.width)===0)return;C||A.push(`\uCEE8\uD14C\uC774\uB108 \uB108\uBE44(${Math.round(L.width)}px) != \uB124\uBE44 \uB108\uBE44(${f}px)`),E||A.push(`\uC591\uCE21 \uB9C8\uC9C4 \uBD88\uADE0\uD615 left=${k}px, right=${T}px`);let D=a("img",y).filter(O=>{if(O.closest(".post-card")||O.classList.contains("post-card-thumb-img"))return!1;let P=getComputedStyle(O);return!(P.display==="block"&&P.marginLeft==="auto"&&P.marginRight==="auto")}).length;D&&A.push(`\uC911\uC559 \uC815\uB82C\uB418\uC9C0 \uC54A\uC740 \uC774\uBBF8\uC9C0 ${D}\uAC1C`),b.push({element:y,widthMatches:C,marginBalanced:E,imgNotCentered:D,issues:A})}),e&&(b.some(y=>y.issues.length)?(console.group("%cLayout Inspector: \uACBD\uACE0","color:#b45309;font-weight:bold"),b.forEach((y,L)=>{y.issues.length&&console.warn(`#${L+1}`,y.issues.join(" | "),y.element)}),console.info("\uC81C\uC548:",["- \uCEE8\uD14C\uC774\uB108\uC5D0 maxWidth\uB97C \uB124\uBE44\uAC8C\uC774\uC158 \uB108\uBE44\uB85C \uB3D9\uAE30\uD654(\uC790\uB3D9 \uC801\uC6A9\uB428).","- \uC591\uCE21 \uB9C8\uC9C4\uC744 auto\uB85C \uC124\uC815\uD574 \uC911\uC559 \uC815\uB82C \uC720\uC9C0(\uC790\uB3D9 \uC801\uC6A9\uB428).","- \uC774\uBBF8\uC9C0\uC5D0 display:block + margin:auto \uC9C0\uC815(\uC790\uB3D9 \uC801\uC6A9\uB428)."].join(`
`)),console.groupEnd()):console.log("%cLayout Inspector: \uC77C\uAD00\uC131 OK","color:#16a34a;font-weight:bold"))),b}function h(f){f&&(f.style.gap=m.gap+"px")}function u(){let f=o();f&&(i===null||Math.abs(f-i)>4)&&(i=f,c(f)),r().forEach(y=>{d(y),h(y),l(y)}),p()}let g=null;function v(){g&&cancelAnimationFrame(g),g=requestAnimationFrame(()=>{g=null,u()})}function x(f){v()}function M(){var b;v(),document.fonts&&typeof((b=document.fonts.ready)==null?void 0:b.then)=="function"&&document.fonts.ready.then(()=>v());let f=s("#app-container");f&&new MutationObserver(()=>{v()}).observe(f,{childList:!0,subtree:!0});let w=s("#main-nav-container nav");w&&"ResizeObserver"in window&&(n=new ResizeObserver(()=>v()),n.observe(w)),window.addEventListener("resize",()=>v())}window.DesignGuide=m,window.LayoutManager={init:M,onViewRendered:x,syncAll:u}})();var z={loadedScripts:new Set,async loadScript(m,t={}){return this.loadedScripts.has(m)?Promise.resolve():new Promise((e,s)=>{let a=document.createElement("script");a.src=m,a.async=t.async!==!1,a.defer=t.defer||!1,t.nonce&&(a.nonce=t.nonce),a.onload=()=>{this.loadedScripts.add(m),e()},a.onerror=()=>{s(new Error(`Failed to load script: ${m}`))},document.head.appendChild(a)})},async loadCSS(m){return document.querySelector(`link[href="${m}"]`)?Promise.resolve():new Promise((t,e)=>{let s=document.createElement("link");s.rel="stylesheet",s.href=m,s.onload=t,s.onerror=()=>e(new Error(`Failed to load CSS: ${m}`)),document.head.appendChild(s)})},async loadEditorJS(){let m=["https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest","https://cdn.jsdelivr.net/npm/@editorjs/header@latest","https://cdn.jsdelivr.net/npm/@editorjs/list@latest","https://cdn.jsdelivr.net/npm/@editorjs/checklist@latest","https://cdn.jsdelivr.net/npm/@editorjs/quote@latest","https://cdn.jsdelivr.net/npm/@editorjs/code@latest","https://cdn.jsdelivr.net/npm/@editorjs/delimiter@latest","https://cdn.jsdelivr.net/npm/@editorjs/table@latest","https://cdn.jsdelivr.net/npm/@editorjs/link@latest","https://cdn.jsdelivr.net/npm/@editorjs/image@latest","https://cdn.jsdelivr.net/npm/editorjs-html@4.0.0/.build/edjsHTML.browser.js"];try{await Promise.all(m.map(t=>this.loadScript(t,{nonce:"r4nd0m"}))),console.log("Editor.js scripts loaded successfully")}catch(t){throw console.error("Failed to load Editor.js scripts:",t),t}},async loadUtilities(){let m=["https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js","https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js","https://unpkg.com/dompurify@3.0.8/dist/purify.min.js"],t=["https://cdn.jsdelivr.net/npm/marked@12.0.2/lib/marked.umd.min.js","https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js","https://unpkg.com/marked@12.0.2/lib/marked.umd.min.js"],e=async s=>{let a;for(let i of s)try{return await this.loadScript(i,{nonce:"r4nd0m"}),console.log("Loaded:",i),!0}catch(n){a=n,console.warn("Failed:",i,n)}throw a||new Error("All sources failed")};try{await e(m),await e(t),console.log("Utility scripts loaded successfully")}catch(s){throw console.error("Failed to load utility scripts:",s),s}},async loadAll(){try{await Promise.all([this.loadUtilities()]),console.log("All scripts loaded successfully")}catch(m){throw console.error("Failed to load scripts:",m),m}}};window.ScriptLoader=z;(function(){if(typeof PerformanceObserver=="undefined")return;let m={};window.PerfMetrics=m;let t="/api/metrics",e=["localhost","127.0.0.1"].includes(window.location.hostname),s=(l,r,p={})=>{try{let h={name:l,value:r,path:window.location.pathname,href:window.location.href,ua:navigator.userAgent,ts:Date.now(),conn:navigator.connection&&navigator.connection.effectiveType||null,...p};if(e)return;let u=JSON.stringify(h);if(navigator.sendBeacon)try{let g=new Blob([u],{type:"application/json"});navigator.sendBeacon(t,g);return}catch(g){}fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:u,keepalive:!0}).catch(()=>{})}catch(h){}},i=new URLSearchParams(window.location.search).get("perf")==="1"||window.Config&&window.Config.SHOW_PERF_OVERLAY===!0,n=null,o=()=>{if(i)return n||(n=document.createElement("div"),n.id="perf-overlay",n.setAttribute("role","status"),n.style.cssText=["position:fixed","right:12px","bottom:12px","z-index:9999","background:rgba(17,24,39,0.8)","color:#fff","backdrop-filter:saturate(120%) blur(2px)","border-radius:10px","padding:10px 12px","font:12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR","box-shadow:0 8px 24px rgba(0,0,0,0.25)"].join(";"),n.innerHTML='<div style="font-weight:600;margin-bottom:6px">Performance</div><div id="perf-lines"></div><div style="margin-top:6px;opacity:.8">?perf=1\uB85C \uD45C\uC2DC \uC911</div>',document.body.appendChild(n),n)},c=()=>{if(!i)return;n||o();let l=n.querySelector("#perf-lines"),r=m,p=[["LCP",r.LCP?`${(r.LCP/1e3).toFixed(2)}s`:"-"],["CLS",r.CLS!==void 0?String(r.CLS):"-"],["FID",r.FID!==void 0?`${Math.round(r.FID)}ms`:"-"],["TTFB",r.TTFB!==void 0?`${Math.round(r.TTFB)}ms`:"-"]];l.innerHTML=p.map(([h,u])=>`<div><span style="display:inline-block;width:42px;opacity:.8">${h}</span> <span style="font-weight:600">${u}</span></div>`).join("")},d=(l,r,p={})=>{m[l]=r,["localhost","127.0.0.1"].includes(window.location.hostname)&&console.log(`[perf] ${l}:`,r,p),s(l,r,p),c()};try{let l=()=>{let r=performance&&performance.memory;r&&d("JSHeapUsed",r.usedJSHeapSize,{total:r.totalJSHeapSize,limit:r.jsHeapSizeLimit})};document.readyState==="complete"?l():window.addEventListener("load",()=>setTimeout(l,1200),{once:!0}),window.addEventListener("click",()=>setTimeout(l,800),{once:!0})}catch(l){}try{new PerformanceObserver(r=>{let p=r.getEntries();for(let h of p)d("LongTask",h.duration,{name:h.name||"longtask"})}).observe({type:"longtask",buffered:!0})}catch(l){}try{new PerformanceObserver(r=>{let p=r.getEntries(),h=p[p.length-1];h&&d("LCP",h.renderTime||h.loadTime||h.startTime,{size:h.size})}).observe({type:"largest-contentful-paint",buffered:!0})}catch(l){}try{let l=0;new PerformanceObserver(p=>{for(let h of p.getEntries())h.hadRecentInput||(l+=h.value,d("CLS",Number(l.toFixed(4))))}).observe({type:"layout-shift",buffered:!0})}catch(l){}try{new PerformanceObserver(r=>{let p=r.getEntries();for(let h of p)h.name==="first-input"&&d("FID",h.processingStart-h.startTime)}).observe({type:"first-input",buffered:!0})}catch(l){}try{let l=performance.getEntriesByType("navigation")[0];l&&(d("TTFB",l.responseStart),d("DOM Interactive",l.domInteractive),d("Load Event End",l.loadEventEnd))}catch(l){}i&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o,{once:!0}):o())})();})();
