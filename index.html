<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsureLog</title>
    <meta name="description" content="AI, 기술, 그리고 보험에 대한 깊이 있는 분석과 기록들.">
    <link rel="canonical" href="https://blogaipandoci.vercel.app">
    <meta name="robots" content="index,follow">
    <meta name="theme-color" content="#ffffff">
    <meta name="nonce" content="r4nd0m">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Crect width='256' height='256' fill='%23D946EF'/%3E%3Ctext x='50%25' y='50%25' dy='.35em' text-anchor='middle' font-family='Arial' font-size='140' fill='white'%3EI%3C/text%3E%3C/svg%3E">
    
    <!-- 외부 CDN 및 API에 대한 초기 연결 준비로 체인 대기 단축 -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://ddehwkwzmmvcxltlplua.supabase.co" crossorigin>
    <link rel="dns-prefetch" href="//ddehwkwzmmvcxltlplua.supabase.co">
    
    <!-- CSP (Content Security Policy) -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'nonce-r4nd0m' 'unsafe-eval' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://pagead2.googlesyndication.com https://www.googlesyndication.com https://www.googletagservices.com https://partner.googleadservices.com https://www.google-analytics.com https://*.adtrafficquality.google https://vercel.live; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: blob: https://*.supabase.co https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://i.ytimg.com https://*.adtrafficquality.google; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://*.supabase.co https://www.google-analytics.com https://*.google.com https://*.googlesyndication.com https://*.doubleclick.net https://*.g.doubleclick.net https://*.googleadservices.com https://*.gstatic.com https://imasdk.googleapis.com https://*.adtrafficquality.google https://*.gemius.pl https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com; frame-src 'self' https://*.youtube.com https://*.youtu.be https://*.vimeo.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://*.adtrafficquality.google https://*.google.com https://*.googlesyndication.com; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://blogaipandoci.vercel.app">
    <meta property="og:title" content="InsureLog - AI, 기술, 그리고 보험">
    <meta property="og:description" content="AI, 기술, 그리고 보험에 대한 깊이 있는 분석과 기록들.">
    <meta property="og:image" content="https://blogaipandoci.vercel.app/og-image.svg">
    <meta property="og:site_name" content="InsureLog">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="InsureLog - AI, 기술, 그리고 보험">
    <meta name="twitter:description" content="AI, 기술, 그리고 보험에 대한 깊이 있는 분석과 기록들.">
    <meta name="twitter:image" content="https://blogaipandoci.vercel.app/og-image.svg">
    <!-- 번들 프리로드 (존재할 경우만 브라우저가 가져옴; 없으면 무시) -->
    <link rel="preload" as="script" href="/app.bundle.min.js" crossorigin>
    
    <!-- Scripts & Stylesheets -->
    <!-- 스타일 유틸리티(style.css)는 유지하고, 모듈 CSS는 개별 링크로 병렬 로드 -->
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/css/design-system.css">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/layout.css">
    <!-- 비임계 CSS: CSP 준수를 위해 인라인 onload 제거, 일반 스타일 링크로 전환 -->
    <!-- 비임계 CSS는 초기 페인트 후 지연 로드 (렌더링 차단 최소화) -->
    <link rel="stylesheet" href="/css/main.css">
    <!-- 코드 하이라이트 CSS는 초기 페인트 이후 지연 로드로 전환 -->

    <!-- Structured Data (JSON-LD): WebSite & Organization -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "InsureLog",
      "url": "https://blogaipandoci.vercel.app",
      "inLanguage": "ko-KR"
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "InsureLog",
      "url": "https://blogaipandoci.vercel.app",
      "logo": "https://blogaipandoci.vercel.app/og-image.svg"
    }
    </script>

    <!-- Global Config: Supabase URL/KEYs injected from user-provided values -->
    <script nonce="r4nd0m">
        window.Config = window.Config || {};
        // Supabase 프로젝트 URL
        window.Config.SUPABASE_URL = 'https://ddehwkwzmmvcxltlplua.supabase.co';
        // 공개용(클라이언트) anon 키
        window.Config.SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZWh3a3d6bW12Y3hsdGxwbHVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2MjcyNTgsImV4cCI6MjA3MjIwMzI1OH0.VNK-2RYRvLUr9f4fg59kQEEgjwUBZZQsQsrld9Zg7To';
        // 프로덕션 사이트 URL (매직링크 리디렉션 기준)
        window.Config.SITE_URL = 'https://blogaipandoci.vercel.app';
        // Storage 이미지 버킷명 (LCP 이미지/썸네일 변환에 사용)
        window.Config.IMAGE_BUCKET_NAME = 'thought-images';
    </script>

    <!-- Fonts -->
    <!-- 외부 도메인 프리커넥트/프리페치는 리소스 절약을 위해 제거 -->
    <!-- 폰트 스타일시트는 초기 페인트 후 비동기 로드로 전환 -->

    <!-- Google AdSense (프로덕션 환경에서만 로드) -->
</head>
<body class="antialiased">
    <a href="#app-container" class="skip-link">본문 바로가기</a>
    <!-- 앱 로더 -->
    <div id="app-loader" class="fixed inset-0 z-50 bg-white flex items-center justify-center" hidden>
        <div class="loader-spinner"></div>
    </div>
    
    <!-- 헤더 (네비게이션) -->
    <header id="main-nav-container" class="sticky top-0 z-40 w-full flex justify-center p-1 sm:p-2 bg-white/80 backdrop-blur-sm"></header>
    
    <!-- 메인 콘텐츠 (뷰가 렌더링되는 곳) -->
    <main id="app-container" class="w-full">
    <div id="view-library" class="app-view"></div>
    <div id="view-post" class="app-view"></div>
    <div id="view-dashboard" class="app-view"></div>
    <div id="view-writer" class="app-view"></div>
    <div id="view-archives" class="app-view"></div>
    </main>

    <!-- 푸터 -->
    <footer class="text-center py-8 px-4 border-t border-gray-200">
        <p class="text-sm text-gray-600">
            © 2025 InsureLog. 
            개발 및 문의사항은 <a href="https://www.threads.net/@ilovemom_2026" target="_blank" rel="noopener noreferrer" class="font-semibold text-gray-500 hover:text-black transition-colors underline">Threads</a>로 연락 주세요.
        </p>
    </footer>

    <!-- 오프라인 배너 및 관련 기능 제거됨 -->

    <!-- 모달 및 토스트 컨테이너 -->
    <div id="modal-container"></div>
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-3" aria-live="polite" aria-atomic="true"></div>
    
    <!-- [APP SCRIPT] -->
    <!-- Supabase ES 모듈 임포트 (다중 CDN 폴백) -->
    <script type="module" nonce="r4nd0m">
        // 비임계 CSS 지연 로드: 초기 컨텐츠가 그려진 뒤에 로드하여 렌더링 차단을 줄임
        const loadStyle = (href) => new Promise((resolve, reject) => {
            if (document.querySelector(`link[rel="stylesheet"][href="${href}"]`)) return resolve();
            const l = document.createElement('link');
            l.rel = 'stylesheet';
            l.href = href;
            l.onload = () => resolve();
            l.onerror = () => reject(new Error(`Failed to load CSS: ${href}`));
            document.head.appendChild(l);
        });
        const nonCriticalCSS = [
            '/css/buttons.css',
            '/css/forms.css',
            '/css/modal.css',
            '/css/toast.css',
            '/css/loader.css',
            '/css/skeleton.css',
            '/css/error.css',
            'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css'
        ];
        const loadNonCriticalCSS = () => {
            nonCriticalCSS.forEach(href => {
                loadStyle(href).catch(() => {});
            });
        };
        if ('requestIdleCallback' in window) {
            requestIdleCallback(loadNonCriticalCSS, { timeout: 1500 });
        } else {
            setTimeout(loadNonCriticalCSS, 800);
        }
        // 네트워크 성능: 필요 시점에만 빠르게 연결 준비 (Just-In-Time preconnect)
        function addPreconnect(origin) {
            try {
                if (!origin) return;
                const u = new URL(origin, window.location.origin).origin;
                const existed = document.querySelector(`link[rel="preconnect"][href="${u}"]`);
                if (existed) return;
                const l = document.createElement('link');
                l.rel = 'preconnect';
                l.href = u;
                l.crossOrigin = 'anonymous';
                document.head.appendChild(l);
            } catch { /* noop */ }
        }

        // Prefetch 및 네트워크 상태 기반 최적화 기능 제거됨
        // Google Fonts 비동기 로더 제거: 네트워크 리소스 절약
        // 오프라인 배너 및 온라인/오프라인 상태 감지 로직 제거됨
        async function loadSupabaseModule() {
            const sources = [
                'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm',
                'https://unpkg.com/@supabase/supabase-js@2.45.5/+esm'
            ];
            for (const src of sources) {
                try {
                    // 모듈 임포트 직전에 해당 CDN으로 preconnect하여 로드 지연을 줄입니다.
                    try { addPreconnect(new URL(src).origin); } catch { /* noop */ }
                    const mod = await import(src);
                    console.log('Supabase loaded from:', src);
                    return mod;
                } catch (e) {
                    console.warn('Supabase import failed from', src, e);
                }
            }
            throw new Error('Supabase import failed from all sources');
        }

        // Supabase ES 모듈은 로그인/세션 초기화를 위해 앱보다 먼저 준비합니다.
        try {
            (async () => {
                try {
                    const { createClient } = await loadSupabaseModule();
                    window.supabase = { createClient };
                    console.log('Supabase ready (eager)');
                } catch (e) {
                    console.warn('Supabase eager load failed:', e);
                }
            })();
        } catch (_) { /* noop */ }
        
        // 개발 환경에서는 Google AdSense 로드를 건너뜁니다 (403 및 Quirks Mode 회피)
        // 광고 스크립트는 프로덕션 도메인(HTTPS)에서만 로드
        const isProdHost = window.location.protocol === 'https:'
            && ['blogaipandoci.vercel.app'].includes(window.location.hostname);
        const adsEnabled = isProdHost && (window.Config?.ADS_ENABLED !== false);
        if (adsEnabled) {
            const loadAdsScript = () => {
                if (window.__adsScriptLoaded) return;
                // 필요 시점에만 프리커넥트 추가 (전역 유틸 재사용)
                addPreconnect('https://pagead2.googlesyndication.com');
                addPreconnect('https://googleads.g.doubleclick.net');

                const adsScript = document.createElement('script');
                adsScript.async = true;
                adsScript.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5239497835591112';
                adsScript.setAttribute('crossorigin', 'anonymous');
                adsScript.nonce = 'r4nd0m';
                adsScript.dataset.loaded = '1';
                window.__adsScriptLoaded = true;
                document.head.appendChild(adsScript);
            };
            // 실제 광고 슬롯이 존재하고, 가시 영역에 들어올 때만 로드
            const slots = () => Array.from(document.querySelectorAll('.adsbygoogle'));
            const beginGate = () => {
                const els = slots();
                if (!els.length || window.__adsScriptLoaded) return; // 슬롯이 없으면 스크립트 로드 생략
                if ('IntersectionObserver' in window) {
                    const io = new IntersectionObserver((entries, obs) => {
                        for (const e of entries) {
                            if (e.isIntersecting) {
                                obs.disconnect();
                                loadAdsScript();
                                break;
                            }
                        }
                    }, { rootMargin: '0px' }); // 가시 영역에 들어올 때만 로드
                    els.forEach(el => io.observe(el));
                } else {
                    // 폴백: 사용자 상호작용 후 로드
                    window.addEventListener('scroll', () => {
                        loadAdsScript();
                    }, { once: true, passive: true });
                }
            };
            // 슬롯이 나중에 동적으로 추가되는 경우를 대비해 감시
            const observeSlotsLater = () => {
                if (!('MutationObserver' in window)) return;
                const mo = new MutationObserver(() => {
                    if (window.__adsScriptLoaded) { mo.disconnect(); return; }
                    beginGate();
                });
                mo.observe(document.body, { childList: true, subtree: true });
            };
            const startGate = () => {
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => { beginGate(); observeSlotsLater(); });
                } else {
                    beginGate();
                    observeSlotsLater();
                }
            };
            if (document.fonts && typeof document.fonts.ready?.then === 'function') {
                document.fonts.ready.then(startGate);
            } else {
                startGate();
            }
        } else {
            console.info('[Ads] 비프로덕션 호스트에서 광고 로드를 건너뜁니다:', window.location.hostname);
        }

        // 분리된 JavaScript 모듈들 로드
        // .min.js가 존재하면 우선 로드, 실패 시 원본으로 폴백
        const resolveMinPath = (src) => src.replace(/\.js$/, '.min.js');
        const loadScript = (src) => {
            return new Promise((resolve, reject) => {
                const tryLoad = (candidate, fallback) => {
                    const s = document.createElement('script');
                    s.src = candidate;
                    s.nonce = 'r4nd0m';
                    s.onload = resolve;
                    s.onerror = () => {
                        if (fallback && candidate !== fallback) {
                            tryLoad(fallback, null);
                        } else {
                            reject(new Error('Script load failed: ' + candidate));
                        }
                    };
                    document.head.appendChild(s);
                };
                // 최소화된 파일 우선 시도
                tryLoad(resolveMinPath(src), src);
            });
        };
        
        // Supabase 준비 대기 유틸리티 (동적 모듈 로딩과 경합 방지)
        const waitForSupabaseReady = async (maxWaitMs = 3000) => {
            const start = Date.now();
            while ((Date.now() - start) < maxWaitMs) {
                try {
                    if (window.supabase && typeof window.supabase.createClient === 'function') return true;
                } catch (_) { /* noop */ }
                await new Promise(r => setTimeout(r, 50));
            }
            return !!(window.supabase && typeof window.supabase.createClient === 'function');
        };

        // 번들이 존재하면 우선 로드하여 네트워크 왕복을 줄입니다.
        async function tryLoadBundleAndBoot() {
            const candidates = ['/app.bundle.min.js', '/app.bundle.js'];
            for (const url of candidates) {
                try {
                    const res = await fetch(url, { method: 'HEAD' });
                    if (!res.ok) continue;
                    await new Promise((resolve, reject) => {
                        const s = document.createElement('script');
                        s.src = url;
                        s.defer = true;
                        s.nonce = 'r4nd0m';
                        s.onload = resolve;
                        s.onerror = () => reject(new Error('Bundle load failed'));
                        document.head.appendChild(s);
                    });
                    // 번들에는 BlogApp/DOM/UIComponents 등이 포함됨
                    const boot = () => {
                        new BlogApp();
                        const tryInitLayout = () => { if (window.LayoutManager) window.LayoutManager.init(); };
                        if ('requestIdleCallback' in window) {
                            requestIdleCallback(tryInitLayout);
                        } else {
                            setTimeout(tryInitLayout, 1200);
                        }
                    };
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', boot);
                    } else {
                        boot();
                    }
                    return true;
                } catch (_) { /* 다음 후보 시도 */ }
            }
            return false;
        }

        // 모듈들을 순차적으로 로드 (의존성 보장)
        (async () => {
            try {
                // 번들 우선 시도
                const bundled = await tryLoadBundleAndBoot();
                if (bundled) return;
                // Config와 DOM 유틸을 먼저 로드해 기본 전역을 준비
                await loadScript('/js/config.js');
                await loadScript('/js/dom-utils.js');
                // 초기 화면 구성 요소를 빠르게 파싱
                await loadScript('/js/ui-components.js');
                // Supabase 동적 임포트가 선행되도록 대기 (초기화 경합 방지)
                await waitForSupabaseReady(3500);
                await loadScript('/js/blog-app.js');
                // 레이아웃 매니저 및 부가 모듈은 초기 페인트 이후 유휴 시간에 로드
                const deferScript = (src) => {
                  if ('requestIdleCallback' in window) {
                    requestIdleCallback(() => loadScript(src));
                  } else {
                    setTimeout(() => loadScript(src), 1000);
                  }
                };
                deferScript('/js/layout-manager.js');
                deferScript('/js/script-loader.js');
                deferScript('/js/perf-monitor.js');
                
                const boot = () => {
                    new BlogApp();
                    // 레이아웃 매니저가 나중에 로드되는 경우 초기화 예약
                    const tryInitLayout = () => { if (window.LayoutManager) window.LayoutManager.init(); };
                    if ('requestIdleCallback' in window) {
                        requestIdleCallback(tryInitLayout);
                    } else {
                        setTimeout(tryInitLayout, 1200);
                    }
                };
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', boot);
                } else {
                    boot();
                }
            } catch (error) {
                console.error('모듈 로드 실패:', error);
                const loaderEl = document.getElementById('app-loader');
                if (loaderEl) loaderEl.innerHTML = '<div class="text-red-600">앱 로드에 실패했습니다.</div>';
            }
        })();
    </script>
</body>
</html>